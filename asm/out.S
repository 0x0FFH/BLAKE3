# This file is generated by asm.py. Don'target edit this file directly.
blake3_sse2_kernel2d_1:
        paddd xmm0, xmm4
        paddd xmm0, xmm1
        pxor xmm3, xmm0
        pshuflw xmm3, xmm3, 0xB1
        pshufhw xmm3, xmm3, 0xB1
        paddd xmm2, xmm3
        pxor xmm1, xmm2
        movdqa xmm11, xmm1
        pslld xmm1, 20
        psrld xmm11, 12
        por xmm1, xmm11
        paddd xmm0, xmm5
        paddd xmm0, xmm1
        pxor xmm3, xmm0
        movdqa xmm11, xmm3
        pslld xmm3, 24
        psrld xmm11, 8
        por xmm3, xmm11
        paddd xmm2, xmm3
        pxor xmm1, xmm2
        movdqa xmm11, xmm1
        pslld xmm1, 25
        psrld xmm11, 7
        por xmm1, xmm11
        pshufd xmm0, xmm0, 0x93
        pshufd xmm3, xmm3, 0x4E
        pshufd xmm2, xmm2, 0x39
        paddd xmm0, xmm6
        paddd xmm0, xmm1
        pxor xmm3, xmm0
        pshuflw xmm3, xmm3, 0xB1
        pshufhw xmm3, xmm3, 0xB1
        paddd xmm2, xmm3
        pxor xmm1, xmm2
        movdqa xmm11, xmm1
        pslld xmm1, 20
        psrld xmm11, 12
        por xmm1, xmm11
        paddd xmm0, xmm7
        paddd xmm0, xmm1
        pxor xmm3, xmm0
        movdqa xmm11, xmm3
        pslld xmm3, 24
        psrld xmm11, 8
        por xmm3, xmm11
        paddd xmm2, xmm3
        pxor xmm1, xmm2
        movdqa xmm11, xmm1
        pslld xmm1, 25
        psrld xmm11, 7
        por xmm1, xmm11
        pshufd xmm0, xmm0, 0x39
        pshufd xmm3, xmm3, 0x4E
        pshufd xmm2, xmm2, 0x93
        movdqa xmm8, xmm4
        shufps xmm8, xmm5, 214
        pshufd xmm9, xmm4, 0x0F
        pshufd xmm4, xmm8, 0x39
        movdqa xmm8, xmm6
        shufps xmm8, xmm7, 250
        pand xmm9, xmmword ptr [PBLENDW_0x33_MASK+rip]
        pand xmm8, xmmword ptr [PBLENDW_0xCC_MASK+rip]
        por xmm9, xmm8
        movdqa xmm8, xmm7
        punpcklqdq xmm8, xmm5
        movdqa xmm10, xmm6
        pand xmm8, xmmword ptr [PBLENDW_0x3F_MASK+rip]
        pand xmm10, xmmword ptr [PBLENDW_0xC0_MASK+rip]
        por xmm8, xmm10
        pshufd xmm8, xmm8, 0x78
        punpckhdq xmm5, xmm7
        punpckldq xmm6, xmm5
        pshufd xmm7, xmm6, 0x1E
        movdqa xmm5, xmm9
        movdqa xmm6, xmm8
        paddd xmm0, xmm4
        paddd xmm0, xmm1
        pxor xmm3, xmm0
        pshuflw xmm3, xmm3, 0xB1
        pshufhw xmm3, xmm3, 0xB1
        paddd xmm2, xmm3
        pxor xmm1, xmm2
        movdqa xmm11, xmm1
        pslld xmm1, 20
        psrld xmm11, 12
        por xmm1, xmm11
        paddd xmm0, xmm5
        paddd xmm0, xmm1
        pxor xmm3, xmm0
        movdqa xmm11, xmm3
        pslld xmm3, 24
        psrld xmm11, 8
        por xmm3, xmm11
        paddd xmm2, xmm3
        pxor xmm1, xmm2
        movdqa xmm11, xmm1
        pslld xmm1, 25
        psrld xmm11, 7
        por xmm1, xmm11
        pshufd xmm0, xmm0, 0x93
        pshufd xmm3, xmm3, 0x4E
        pshufd xmm2, xmm2, 0x39
        paddd xmm0, xmm6
        paddd xmm0, xmm1
        pxor xmm3, xmm0
        pshuflw xmm3, xmm3, 0xB1
        pshufhw xmm3, xmm3, 0xB1
        paddd xmm2, xmm3
        pxor xmm1, xmm2
        movdqa xmm11, xmm1
        pslld xmm1, 20
        psrld xmm11, 12
        por xmm1, xmm11
        paddd xmm0, xmm7
        paddd xmm0, xmm1
        pxor xmm3, xmm0
        movdqa xmm11, xmm3
        pslld xmm3, 24
        psrld xmm11, 8
        por xmm3, xmm11
        paddd xmm2, xmm3
        pxor xmm1, xmm2
        movdqa xmm11, xmm1
        pslld xmm1, 25
        psrld xmm11, 7
        por xmm1, xmm11
        pshufd xmm0, xmm0, 0x39
        pshufd xmm3, xmm3, 0x4E
        pshufd xmm2, xmm2, 0x93
        movdqa xmm8, xmm4
        shufps xmm8, xmm5, 214
        pshufd xmm9, xmm4, 0x0F
        pshufd xmm4, xmm8, 0x39
        movdqa xmm8, xmm6
        shufps xmm8, xmm7, 250
        pand xmm9, xmmword ptr [PBLENDW_0x33_MASK+rip]
        pand xmm8, xmmword ptr [PBLENDW_0xCC_MASK+rip]
        por xmm9, xmm8
        movdqa xmm8, xmm7
        punpcklqdq xmm8, xmm5
        movdqa xmm10, xmm6
        pand xmm8, xmmword ptr [PBLENDW_0x3F_MASK+rip]
        pand xmm10, xmmword ptr [PBLENDW_0xC0_MASK+rip]
        por xmm8, xmm10
        pshufd xmm8, xmm8, 0x78
        punpckhdq xmm5, xmm7
        punpckldq xmm6, xmm5
        pshufd xmm7, xmm6, 0x1E
        movdqa xmm5, xmm9
        movdqa xmm6, xmm8
        paddd xmm0, xmm4
        paddd xmm0, xmm1
        pxor xmm3, xmm0
        pshuflw xmm3, xmm3, 0xB1
        pshufhw xmm3, xmm3, 0xB1
        paddd xmm2, xmm3
        pxor xmm1, xmm2
        movdqa xmm11, xmm1
        pslld xmm1, 20
        psrld xmm11, 12
        por xmm1, xmm11
        paddd xmm0, xmm5
        paddd xmm0, xmm1
        pxor xmm3, xmm0
        movdqa xmm11, xmm3
        pslld xmm3, 24
        psrld xmm11, 8
        por xmm3, xmm11
        paddd xmm2, xmm3
        pxor xmm1, xmm2
        movdqa xmm11, xmm1
        pslld xmm1, 25
        psrld xmm11, 7
        por xmm1, xmm11
        pshufd xmm0, xmm0, 0x93
        pshufd xmm3, xmm3, 0x4E
        pshufd xmm2, xmm2, 0x39
        paddd xmm0, xmm6
        paddd xmm0, xmm1
        pxor xmm3, xmm0
        pshuflw xmm3, xmm3, 0xB1
        pshufhw xmm3, xmm3, 0xB1
        paddd xmm2, xmm3
        pxor xmm1, xmm2
        movdqa xmm11, xmm1
        pslld xmm1, 20
        psrld xmm11, 12
        por xmm1, xmm11
        paddd xmm0, xmm7
        paddd xmm0, xmm1
        pxor xmm3, xmm0
        movdqa xmm11, xmm3
        pslld xmm3, 24
        psrld xmm11, 8
        por xmm3, xmm11
        paddd xmm2, xmm3
        pxor xmm1, xmm2
        movdqa xmm11, xmm1
        pslld xmm1, 25
        psrld xmm11, 7
        por xmm1, xmm11
        pshufd xmm0, xmm0, 0x39
        pshufd xmm3, xmm3, 0x4E
        pshufd xmm2, xmm2, 0x93
        movdqa xmm8, xmm4
        shufps xmm8, xmm5, 214
        pshufd xmm9, xmm4, 0x0F
        pshufd xmm4, xmm8, 0x39
        movdqa xmm8, xmm6
        shufps xmm8, xmm7, 250
        pand xmm9, xmmword ptr [PBLENDW_0x33_MASK+rip]
        pand xmm8, xmmword ptr [PBLENDW_0xCC_MASK+rip]
        por xmm9, xmm8
        movdqa xmm8, xmm7
        punpcklqdq xmm8, xmm5
        movdqa xmm10, xmm6
        pand xmm8, xmmword ptr [PBLENDW_0x3F_MASK+rip]
        pand xmm10, xmmword ptr [PBLENDW_0xC0_MASK+rip]
        por xmm8, xmm10
        pshufd xmm8, xmm8, 0x78
        punpckhdq xmm5, xmm7
        punpckldq xmm6, xmm5
        pshufd xmm7, xmm6, 0x1E
        movdqa xmm5, xmm9
        movdqa xmm6, xmm8
        paddd xmm0, xmm4
        paddd xmm0, xmm1
        pxor xmm3, xmm0
        pshuflw xmm3, xmm3, 0xB1
        pshufhw xmm3, xmm3, 0xB1
        paddd xmm2, xmm3
        pxor xmm1, xmm2
        movdqa xmm11, xmm1
        pslld xmm1, 20
        psrld xmm11, 12
        por xmm1, xmm11
        paddd xmm0, xmm5
        paddd xmm0, xmm1
        pxor xmm3, xmm0
        movdqa xmm11, xmm3
        pslld xmm3, 24
        psrld xmm11, 8
        por xmm3, xmm11
        paddd xmm2, xmm3
        pxor xmm1, xmm2
        movdqa xmm11, xmm1
        pslld xmm1, 25
        psrld xmm11, 7
        por xmm1, xmm11
        pshufd xmm0, xmm0, 0x93
        pshufd xmm3, xmm3, 0x4E
        pshufd xmm2, xmm2, 0x39
        paddd xmm0, xmm6
        paddd xmm0, xmm1
        pxor xmm3, xmm0
        pshuflw xmm3, xmm3, 0xB1
        pshufhw xmm3, xmm3, 0xB1
        paddd xmm2, xmm3
        pxor xmm1, xmm2
        movdqa xmm11, xmm1
        pslld xmm1, 20
        psrld xmm11, 12
        por xmm1, xmm11
        paddd xmm0, xmm7
        paddd xmm0, xmm1
        pxor xmm3, xmm0
        movdqa xmm11, xmm3
        pslld xmm3, 24
        psrld xmm11, 8
        por xmm3, xmm11
        paddd xmm2, xmm3
        pxor xmm1, xmm2
        movdqa xmm11, xmm1
        pslld xmm1, 25
        psrld xmm11, 7
        por xmm1, xmm11
        pshufd xmm0, xmm0, 0x39
        pshufd xmm3, xmm3, 0x4E
        pshufd xmm2, xmm2, 0x93
        movdqa xmm8, xmm4
        shufps xmm8, xmm5, 214
        pshufd xmm9, xmm4, 0x0F
        pshufd xmm4, xmm8, 0x39
        movdqa xmm8, xmm6
        shufps xmm8, xmm7, 250
        pand xmm9, xmmword ptr [PBLENDW_0x33_MASK+rip]
        pand xmm8, xmmword ptr [PBLENDW_0xCC_MASK+rip]
        por xmm9, xmm8
        movdqa xmm8, xmm7
        punpcklqdq xmm8, xmm5
        movdqa xmm10, xmm6
        pand xmm8, xmmword ptr [PBLENDW_0x3F_MASK+rip]
        pand xmm10, xmmword ptr [PBLENDW_0xC0_MASK+rip]
        por xmm8, xmm10
        pshufd xmm8, xmm8, 0x78
        punpckhdq xmm5, xmm7
        punpckldq xmm6, xmm5
        pshufd xmm7, xmm6, 0x1E
        movdqa xmm5, xmm9
        movdqa xmm6, xmm8
        paddd xmm0, xmm4
        paddd xmm0, xmm1
        pxor xmm3, xmm0
        pshuflw xmm3, xmm3, 0xB1
        pshufhw xmm3, xmm3, 0xB1
        paddd xmm2, xmm3
        pxor xmm1, xmm2
        movdqa xmm11, xmm1
        pslld xmm1, 20
        psrld xmm11, 12
        por xmm1, xmm11
        paddd xmm0, xmm5
        paddd xmm0, xmm1
        pxor xmm3, xmm0
        movdqa xmm11, xmm3
        pslld xmm3, 24
        psrld xmm11, 8
        por xmm3, xmm11
        paddd xmm2, xmm3
        pxor xmm1, xmm2
        movdqa xmm11, xmm1
        pslld xmm1, 25
        psrld xmm11, 7
        por xmm1, xmm11
        pshufd xmm0, xmm0, 0x93
        pshufd xmm3, xmm3, 0x4E
        pshufd xmm2, xmm2, 0x39
        paddd xmm0, xmm6
        paddd xmm0, xmm1
        pxor xmm3, xmm0
        pshuflw xmm3, xmm3, 0xB1
        pshufhw xmm3, xmm3, 0xB1
        paddd xmm2, xmm3
        pxor xmm1, xmm2
        movdqa xmm11, xmm1
        pslld xmm1, 20
        psrld xmm11, 12
        por xmm1, xmm11
        paddd xmm0, xmm7
        paddd xmm0, xmm1
        pxor xmm3, xmm0
        movdqa xmm11, xmm3
        pslld xmm3, 24
        psrld xmm11, 8
        por xmm3, xmm11
        paddd xmm2, xmm3
        pxor xmm1, xmm2
        movdqa xmm11, xmm1
        pslld xmm1, 25
        psrld xmm11, 7
        por xmm1, xmm11
        pshufd xmm0, xmm0, 0x39
        pshufd xmm3, xmm3, 0x4E
        pshufd xmm2, xmm2, 0x93
        movdqa xmm8, xmm4
        shufps xmm8, xmm5, 214
        pshufd xmm9, xmm4, 0x0F
        pshufd xmm4, xmm8, 0x39
        movdqa xmm8, xmm6
        shufps xmm8, xmm7, 250
        pand xmm9, xmmword ptr [PBLENDW_0x33_MASK+rip]
        pand xmm8, xmmword ptr [PBLENDW_0xCC_MASK+rip]
        por xmm9, xmm8
        movdqa xmm8, xmm7
        punpcklqdq xmm8, xmm5
        movdqa xmm10, xmm6
        pand xmm8, xmmword ptr [PBLENDW_0x3F_MASK+rip]
        pand xmm10, xmmword ptr [PBLENDW_0xC0_MASK+rip]
        por xmm8, xmm10
        pshufd xmm8, xmm8, 0x78
        punpckhdq xmm5, xmm7
        punpckldq xmm6, xmm5
        pshufd xmm7, xmm6, 0x1E
        movdqa xmm5, xmm9
        movdqa xmm6, xmm8
        paddd xmm0, xmm4
        paddd xmm0, xmm1
        pxor xmm3, xmm0
        pshuflw xmm3, xmm3, 0xB1
        pshufhw xmm3, xmm3, 0xB1
        paddd xmm2, xmm3
        pxor xmm1, xmm2
        movdqa xmm11, xmm1
        pslld xmm1, 20
        psrld xmm11, 12
        por xmm1, xmm11
        paddd xmm0, xmm5
        paddd xmm0, xmm1
        pxor xmm3, xmm0
        movdqa xmm11, xmm3
        pslld xmm3, 24
        psrld xmm11, 8
        por xmm3, xmm11
        paddd xmm2, xmm3
        pxor xmm1, xmm2
        movdqa xmm11, xmm1
        pslld xmm1, 25
        psrld xmm11, 7
        por xmm1, xmm11
        pshufd xmm0, xmm0, 0x93
        pshufd xmm3, xmm3, 0x4E
        pshufd xmm2, xmm2, 0x39
        paddd xmm0, xmm6
        paddd xmm0, xmm1
        pxor xmm3, xmm0
        pshuflw xmm3, xmm3, 0xB1
        pshufhw xmm3, xmm3, 0xB1
        paddd xmm2, xmm3
        pxor xmm1, xmm2
        movdqa xmm11, xmm1
        pslld xmm1, 20
        psrld xmm11, 12
        por xmm1, xmm11
        paddd xmm0, xmm7
        paddd xmm0, xmm1
        pxor xmm3, xmm0
        movdqa xmm11, xmm3
        pslld xmm3, 24
        psrld xmm11, 8
        por xmm3, xmm11
        paddd xmm2, xmm3
        pxor xmm1, xmm2
        movdqa xmm11, xmm1
        pslld xmm1, 25
        psrld xmm11, 7
        por xmm1, xmm11
        pshufd xmm0, xmm0, 0x39
        pshufd xmm3, xmm3, 0x4E
        pshufd xmm2, xmm2, 0x93
        movdqa xmm8, xmm4
        shufps xmm8, xmm5, 214
        pshufd xmm9, xmm4, 0x0F
        pshufd xmm4, xmm8, 0x39
        movdqa xmm8, xmm6
        shufps xmm8, xmm7, 250
        pand xmm9, xmmword ptr [PBLENDW_0x33_MASK+rip]
        pand xmm8, xmmword ptr [PBLENDW_0xCC_MASK+rip]
        por xmm9, xmm8
        movdqa xmm8, xmm7
        punpcklqdq xmm8, xmm5
        movdqa xmm10, xmm6
        pand xmm8, xmmword ptr [PBLENDW_0x3F_MASK+rip]
        pand xmm10, xmmword ptr [PBLENDW_0xC0_MASK+rip]
        por xmm8, xmm10
        pshufd xmm8, xmm8, 0x78
        punpckhdq xmm5, xmm7
        punpckldq xmm6, xmm5
        pshufd xmm7, xmm6, 0x1E
        movdqa xmm5, xmm9
        movdqa xmm6, xmm8
        paddd xmm0, xmm4
        paddd xmm0, xmm1
        pxor xmm3, xmm0
        pshuflw xmm3, xmm3, 0xB1
        pshufhw xmm3, xmm3, 0xB1
        paddd xmm2, xmm3
        pxor xmm1, xmm2
        movdqa xmm11, xmm1
        pslld xmm1, 20
        psrld xmm11, 12
        por xmm1, xmm11
        paddd xmm0, xmm5
        paddd xmm0, xmm1
        pxor xmm3, xmm0
        movdqa xmm11, xmm3
        pslld xmm3, 24
        psrld xmm11, 8
        por xmm3, xmm11
        paddd xmm2, xmm3
        pxor xmm1, xmm2
        movdqa xmm11, xmm1
        pslld xmm1, 25
        psrld xmm11, 7
        por xmm1, xmm11
        pshufd xmm0, xmm0, 0x93
        pshufd xmm3, xmm3, 0x4E
        pshufd xmm2, xmm2, 0x39
        paddd xmm0, xmm6
        paddd xmm0, xmm1
        pxor xmm3, xmm0
        pshuflw xmm3, xmm3, 0xB1
        pshufhw xmm3, xmm3, 0xB1
        paddd xmm2, xmm3
        pxor xmm1, xmm2
        movdqa xmm11, xmm1
        pslld xmm1, 20
        psrld xmm11, 12
        por xmm1, xmm11
        paddd xmm0, xmm7
        paddd xmm0, xmm1
        pxor xmm3, xmm0
        movdqa xmm11, xmm3
        pslld xmm3, 24
        psrld xmm11, 8
        por xmm3, xmm11
        paddd xmm2, xmm3
        pxor xmm1, xmm2
        movdqa xmm11, xmm1
        pslld xmm1, 25
        psrld xmm11, 7
        por xmm1, xmm11
        pshufd xmm0, xmm0, 0x39
        pshufd xmm3, xmm3, 0x4E
        pshufd xmm2, xmm2, 0x93
        pxor xmm0, xmm2
        pxor xmm1, xmm3
        ret
.global blake3_sse2_compress
blake3_sse2_compress:
        movups  xmm0, xmmword ptr [rdi]
        movups  xmm1, xmmword ptr [rdi+0x10]
        movaps  xmm2, xmmword ptr [BLAKE3_IV+rip]
        shl r8, 32
        mov ecx, ecx
        or rcx, r8
        vmovq xmm3, rdx
        vmovq xmm4, rcx
        punpcklqdq xmm3, xmm4
        movups  xmm4, xmmword ptr [rsi]
        movups  xmm5, xmmword ptr [rsi+0x10]
        movaps  xmm8, xmm4
        shufps  xmm4, xmm5, 136
        shufps  xmm8, xmm5, 221
        movaps  xmm5, xmm8
        movups  xmm6, xmmword ptr [rsi+0x20]
        movups  xmm7, xmmword ptr [rsi+0x30]
        movaps  xmm8, xmm6
        shufps  xmm6, xmm7, 136
        pshufd  xmm6, xmm6, 0x93
        shufps  xmm8, xmm7, 221
        pshufd  xmm7, xmm8, 0x93
        call blake3_sse2_kernel2d_1
        movups xmmword ptr [rdi], xmm0
        movups xmmword ptr [rdi+0x10], xmm1
        ret
.balign 16
PBLENDW_0x33_MASK:
.long 0xFFFFFFFF, 0x00000000, 0xFFFFFFFF, 0x00000000
PBLENDW_0xCC_MASK:
.long 0x00000000, 0xFFFFFFFF, 0x00000000, 0xFFFFFFFF
PBLENDW_0x3F_MASK:
.long 0xFFFFFFFF, 0xFFFFFFFF, 0xFFFFFFFF, 0x00000000
PBLENDW_0xC0_MASK:
.long 0x00000000, 0x00000000, 0x00000000, 0xFFFFFFFF
blake3_sse41_kernel2d_1:
        movaps xmm14, xmmword ptr [ROT8+rip]
        movaps xmm15, xmmword ptr [ROT16+rip]
        paddd xmm0, xmm4
        paddd xmm0, xmm1
        pxor xmm3, xmm0
        pshufb xmm3, xmm15
        paddd xmm2, xmm3
        pxor xmm1, xmm2
        movdqa xmm11, xmm1
        pslld xmm1, 20
        psrld xmm11, 12
        por xmm1, xmm11
        paddd xmm0, xmm5
        paddd xmm0, xmm1
        pxor xmm3, xmm0
        pshufb xmm3, xmm14
        paddd xmm2, xmm3
        pxor xmm1, xmm2
        movdqa xmm11, xmm1
        pslld xmm1, 25
        psrld xmm11, 7
        por xmm1, xmm11
        pshufd xmm0, xmm0, 0x93
        pshufd xmm3, xmm3, 0x4E
        pshufd xmm2, xmm2, 0x39
        paddd xmm0, xmm6
        paddd xmm0, xmm1
        pxor xmm3, xmm0
        pshufb xmm3, xmm15
        paddd xmm2, xmm3
        pxor xmm1, xmm2
        movdqa xmm11, xmm1
        pslld xmm1, 20
        psrld xmm11, 12
        por xmm1, xmm11
        paddd xmm0, xmm7
        paddd xmm0, xmm1
        pxor xmm3, xmm0
        pshufb xmm3, xmm14
        paddd xmm2, xmm3
        pxor xmm1, xmm2
        movdqa xmm11, xmm1
        pslld xmm1, 25
        psrld xmm11, 7
        por xmm1, xmm11
        pshufd xmm0, xmm0, 0x39
        pshufd xmm3, xmm3, 0x4E
        pshufd xmm2, xmm2, 0x93
        movdqa xmm8, xmm4
        shufps xmm8, xmm5, 214
        pshufd xmm9, xmm4, 0x0F
        pshufd xmm4, xmm8, 0x39
        movdqa xmm8, xmm6
        shufps xmm8, xmm7, 250
        pblendw xmm9, xmm8, 0xCC
        movdqa xmm8, xmm7
        punpcklqdq xmm8, xmm5
        pblendw xmm8, xmm6, 0xC0
        pshufd xmm8, xmm8, 0x78
        punpckhdq xmm5, xmm7
        punpckldq xmm6, xmm5
        pshufd xmm7, xmm6, 0x1E
        movdqa xmm5, xmm9
        movdqa xmm6, xmm8
        paddd xmm0, xmm4
        paddd xmm0, xmm1
        pxor xmm3, xmm0
        pshufb xmm3, xmm15
        paddd xmm2, xmm3
        pxor xmm1, xmm2
        movdqa xmm11, xmm1
        pslld xmm1, 20
        psrld xmm11, 12
        por xmm1, xmm11
        paddd xmm0, xmm5
        paddd xmm0, xmm1
        pxor xmm3, xmm0
        pshufb xmm3, xmm14
        paddd xmm2, xmm3
        pxor xmm1, xmm2
        movdqa xmm11, xmm1
        pslld xmm1, 25
        psrld xmm11, 7
        por xmm1, xmm11
        pshufd xmm0, xmm0, 0x93
        pshufd xmm3, xmm3, 0x4E
        pshufd xmm2, xmm2, 0x39
        paddd xmm0, xmm6
        paddd xmm0, xmm1
        pxor xmm3, xmm0
        pshufb xmm3, xmm15
        paddd xmm2, xmm3
        pxor xmm1, xmm2
        movdqa xmm11, xmm1
        pslld xmm1, 20
        psrld xmm11, 12
        por xmm1, xmm11
        paddd xmm0, xmm7
        paddd xmm0, xmm1
        pxor xmm3, xmm0
        pshufb xmm3, xmm14
        paddd xmm2, xmm3
        pxor xmm1, xmm2
        movdqa xmm11, xmm1
        pslld xmm1, 25
        psrld xmm11, 7
        por xmm1, xmm11
        pshufd xmm0, xmm0, 0x39
        pshufd xmm3, xmm3, 0x4E
        pshufd xmm2, xmm2, 0x93
        movdqa xmm8, xmm4
        shufps xmm8, xmm5, 214
        pshufd xmm9, xmm4, 0x0F
        pshufd xmm4, xmm8, 0x39
        movdqa xmm8, xmm6
        shufps xmm8, xmm7, 250
        pblendw xmm9, xmm8, 0xCC
        movdqa xmm8, xmm7
        punpcklqdq xmm8, xmm5
        pblendw xmm8, xmm6, 0xC0
        pshufd xmm8, xmm8, 0x78
        punpckhdq xmm5, xmm7
        punpckldq xmm6, xmm5
        pshufd xmm7, xmm6, 0x1E
        movdqa xmm5, xmm9
        movdqa xmm6, xmm8
        paddd xmm0, xmm4
        paddd xmm0, xmm1
        pxor xmm3, xmm0
        pshufb xmm3, xmm15
        paddd xmm2, xmm3
        pxor xmm1, xmm2
        movdqa xmm11, xmm1
        pslld xmm1, 20
        psrld xmm11, 12
        por xmm1, xmm11
        paddd xmm0, xmm5
        paddd xmm0, xmm1
        pxor xmm3, xmm0
        pshufb xmm3, xmm14
        paddd xmm2, xmm3
        pxor xmm1, xmm2
        movdqa xmm11, xmm1
        pslld xmm1, 25
        psrld xmm11, 7
        por xmm1, xmm11
        pshufd xmm0, xmm0, 0x93
        pshufd xmm3, xmm3, 0x4E
        pshufd xmm2, xmm2, 0x39
        paddd xmm0, xmm6
        paddd xmm0, xmm1
        pxor xmm3, xmm0
        pshufb xmm3, xmm15
        paddd xmm2, xmm3
        pxor xmm1, xmm2
        movdqa xmm11, xmm1
        pslld xmm1, 20
        psrld xmm11, 12
        por xmm1, xmm11
        paddd xmm0, xmm7
        paddd xmm0, xmm1
        pxor xmm3, xmm0
        pshufb xmm3, xmm14
        paddd xmm2, xmm3
        pxor xmm1, xmm2
        movdqa xmm11, xmm1
        pslld xmm1, 25
        psrld xmm11, 7
        por xmm1, xmm11
        pshufd xmm0, xmm0, 0x39
        pshufd xmm3, xmm3, 0x4E
        pshufd xmm2, xmm2, 0x93
        movdqa xmm8, xmm4
        shufps xmm8, xmm5, 214
        pshufd xmm9, xmm4, 0x0F
        pshufd xmm4, xmm8, 0x39
        movdqa xmm8, xmm6
        shufps xmm8, xmm7, 250
        pblendw xmm9, xmm8, 0xCC
        movdqa xmm8, xmm7
        punpcklqdq xmm8, xmm5
        pblendw xmm8, xmm6, 0xC0
        pshufd xmm8, xmm8, 0x78
        punpckhdq xmm5, xmm7
        punpckldq xmm6, xmm5
        pshufd xmm7, xmm6, 0x1E
        movdqa xmm5, xmm9
        movdqa xmm6, xmm8
        paddd xmm0, xmm4
        paddd xmm0, xmm1
        pxor xmm3, xmm0
        pshufb xmm3, xmm15
        paddd xmm2, xmm3
        pxor xmm1, xmm2
        movdqa xmm11, xmm1
        pslld xmm1, 20
        psrld xmm11, 12
        por xmm1, xmm11
        paddd xmm0, xmm5
        paddd xmm0, xmm1
        pxor xmm3, xmm0
        pshufb xmm3, xmm14
        paddd xmm2, xmm3
        pxor xmm1, xmm2
        movdqa xmm11, xmm1
        pslld xmm1, 25
        psrld xmm11, 7
        por xmm1, xmm11
        pshufd xmm0, xmm0, 0x93
        pshufd xmm3, xmm3, 0x4E
        pshufd xmm2, xmm2, 0x39
        paddd xmm0, xmm6
        paddd xmm0, xmm1
        pxor xmm3, xmm0
        pshufb xmm3, xmm15
        paddd xmm2, xmm3
        pxor xmm1, xmm2
        movdqa xmm11, xmm1
        pslld xmm1, 20
        psrld xmm11, 12
        por xmm1, xmm11
        paddd xmm0, xmm7
        paddd xmm0, xmm1
        pxor xmm3, xmm0
        pshufb xmm3, xmm14
        paddd xmm2, xmm3
        pxor xmm1, xmm2
        movdqa xmm11, xmm1
        pslld xmm1, 25
        psrld xmm11, 7
        por xmm1, xmm11
        pshufd xmm0, xmm0, 0x39
        pshufd xmm3, xmm3, 0x4E
        pshufd xmm2, xmm2, 0x93
        movdqa xmm8, xmm4
        shufps xmm8, xmm5, 214
        pshufd xmm9, xmm4, 0x0F
        pshufd xmm4, xmm8, 0x39
        movdqa xmm8, xmm6
        shufps xmm8, xmm7, 250
        pblendw xmm9, xmm8, 0xCC
        movdqa xmm8, xmm7
        punpcklqdq xmm8, xmm5
        pblendw xmm8, xmm6, 0xC0
        pshufd xmm8, xmm8, 0x78
        punpckhdq xmm5, xmm7
        punpckldq xmm6, xmm5
        pshufd xmm7, xmm6, 0x1E
        movdqa xmm5, xmm9
        movdqa xmm6, xmm8
        paddd xmm0, xmm4
        paddd xmm0, xmm1
        pxor xmm3, xmm0
        pshufb xmm3, xmm15
        paddd xmm2, xmm3
        pxor xmm1, xmm2
        movdqa xmm11, xmm1
        pslld xmm1, 20
        psrld xmm11, 12
        por xmm1, xmm11
        paddd xmm0, xmm5
        paddd xmm0, xmm1
        pxor xmm3, xmm0
        pshufb xmm3, xmm14
        paddd xmm2, xmm3
        pxor xmm1, xmm2
        movdqa xmm11, xmm1
        pslld xmm1, 25
        psrld xmm11, 7
        por xmm1, xmm11
        pshufd xmm0, xmm0, 0x93
        pshufd xmm3, xmm3, 0x4E
        pshufd xmm2, xmm2, 0x39
        paddd xmm0, xmm6
        paddd xmm0, xmm1
        pxor xmm3, xmm0
        pshufb xmm3, xmm15
        paddd xmm2, xmm3
        pxor xmm1, xmm2
        movdqa xmm11, xmm1
        pslld xmm1, 20
        psrld xmm11, 12
        por xmm1, xmm11
        paddd xmm0, xmm7
        paddd xmm0, xmm1
        pxor xmm3, xmm0
        pshufb xmm3, xmm14
        paddd xmm2, xmm3
        pxor xmm1, xmm2
        movdqa xmm11, xmm1
        pslld xmm1, 25
        psrld xmm11, 7
        por xmm1, xmm11
        pshufd xmm0, xmm0, 0x39
        pshufd xmm3, xmm3, 0x4E
        pshufd xmm2, xmm2, 0x93
        movdqa xmm8, xmm4
        shufps xmm8, xmm5, 214
        pshufd xmm9, xmm4, 0x0F
        pshufd xmm4, xmm8, 0x39
        movdqa xmm8, xmm6
        shufps xmm8, xmm7, 250
        pblendw xmm9, xmm8, 0xCC
        movdqa xmm8, xmm7
        punpcklqdq xmm8, xmm5
        pblendw xmm8, xmm6, 0xC0
        pshufd xmm8, xmm8, 0x78
        punpckhdq xmm5, xmm7
        punpckldq xmm6, xmm5
        pshufd xmm7, xmm6, 0x1E
        movdqa xmm5, xmm9
        movdqa xmm6, xmm8
        paddd xmm0, xmm4
        paddd xmm0, xmm1
        pxor xmm3, xmm0
        pshufb xmm3, xmm15
        paddd xmm2, xmm3
        pxor xmm1, xmm2
        movdqa xmm11, xmm1
        pslld xmm1, 20
        psrld xmm11, 12
        por xmm1, xmm11
        paddd xmm0, xmm5
        paddd xmm0, xmm1
        pxor xmm3, xmm0
        pshufb xmm3, xmm14
        paddd xmm2, xmm3
        pxor xmm1, xmm2
        movdqa xmm11, xmm1
        pslld xmm1, 25
        psrld xmm11, 7
        por xmm1, xmm11
        pshufd xmm0, xmm0, 0x93
        pshufd xmm3, xmm3, 0x4E
        pshufd xmm2, xmm2, 0x39
        paddd xmm0, xmm6
        paddd xmm0, xmm1
        pxor xmm3, xmm0
        pshufb xmm3, xmm15
        paddd xmm2, xmm3
        pxor xmm1, xmm2
        movdqa xmm11, xmm1
        pslld xmm1, 20
        psrld xmm11, 12
        por xmm1, xmm11
        paddd xmm0, xmm7
        paddd xmm0, xmm1
        pxor xmm3, xmm0
        pshufb xmm3, xmm14
        paddd xmm2, xmm3
        pxor xmm1, xmm2
        movdqa xmm11, xmm1
        pslld xmm1, 25
        psrld xmm11, 7
        por xmm1, xmm11
        pshufd xmm0, xmm0, 0x39
        pshufd xmm3, xmm3, 0x4E
        pshufd xmm2, xmm2, 0x93
        movdqa xmm8, xmm4
        shufps xmm8, xmm5, 214
        pshufd xmm9, xmm4, 0x0F
        pshufd xmm4, xmm8, 0x39
        movdqa xmm8, xmm6
        shufps xmm8, xmm7, 250
        pblendw xmm9, xmm8, 0xCC
        movdqa xmm8, xmm7
        punpcklqdq xmm8, xmm5
        pblendw xmm8, xmm6, 0xC0
        pshufd xmm8, xmm8, 0x78
        punpckhdq xmm5, xmm7
        punpckldq xmm6, xmm5
        pshufd xmm7, xmm6, 0x1E
        movdqa xmm5, xmm9
        movdqa xmm6, xmm8
        paddd xmm0, xmm4
        paddd xmm0, xmm1
        pxor xmm3, xmm0
        pshufb xmm3, xmm15
        paddd xmm2, xmm3
        pxor xmm1, xmm2
        movdqa xmm11, xmm1
        pslld xmm1, 20
        psrld xmm11, 12
        por xmm1, xmm11
        paddd xmm0, xmm5
        paddd xmm0, xmm1
        pxor xmm3, xmm0
        pshufb xmm3, xmm14
        paddd xmm2, xmm3
        pxor xmm1, xmm2
        movdqa xmm11, xmm1
        pslld xmm1, 25
        psrld xmm11, 7
        por xmm1, xmm11
        pshufd xmm0, xmm0, 0x93
        pshufd xmm3, xmm3, 0x4E
        pshufd xmm2, xmm2, 0x39
        paddd xmm0, xmm6
        paddd xmm0, xmm1
        pxor xmm3, xmm0
        pshufb xmm3, xmm15
        paddd xmm2, xmm3
        pxor xmm1, xmm2
        movdqa xmm11, xmm1
        pslld xmm1, 20
        psrld xmm11, 12
        por xmm1, xmm11
        paddd xmm0, xmm7
        paddd xmm0, xmm1
        pxor xmm3, xmm0
        pshufb xmm3, xmm14
        paddd xmm2, xmm3
        pxor xmm1, xmm2
        movdqa xmm11, xmm1
        pslld xmm1, 25
        psrld xmm11, 7
        por xmm1, xmm11
        pshufd xmm0, xmm0, 0x39
        pshufd xmm3, xmm3, 0x4E
        pshufd xmm2, xmm2, 0x93
        pxor xmm0, xmm2
        pxor xmm1, xmm3
        ret
.global blake3_sse41_compress
blake3_sse41_compress:
        movups  xmm0, xmmword ptr [rdi]
        movups  xmm1, xmmword ptr [rdi+0x10]
        movaps  xmm2, xmmword ptr [BLAKE3_IV+rip]
        shl r8, 32
        mov ecx, ecx
        or rcx, r8
        vmovq xmm3, rdx
        vmovq xmm4, rcx
        punpcklqdq xmm3, xmm4
        movups  xmm4, xmmword ptr [rsi]
        movups  xmm5, xmmword ptr [rsi+0x10]
        movaps  xmm8, xmm4
        shufps  xmm4, xmm5, 136
        shufps  xmm8, xmm5, 221
        movaps  xmm5, xmm8
        movups  xmm6, xmmword ptr [rsi+0x20]
        movups  xmm7, xmmword ptr [rsi+0x30]
        movaps  xmm8, xmm6
        shufps  xmm6, xmm7, 136
        pshufd  xmm6, xmm6, 0x93
        shufps  xmm8, xmm7, 221
        pshufd  xmm7, xmm8, 0x93
        call blake3_sse41_kernel2d_1
        movups xmmword ptr [rdi], xmm0
        movups xmmword ptr [rdi+0x10], xmm1
        ret
blake3_avx2_kernel2d_2:
        vbroadcasti128 ymm14, xmmword ptr [ROT16+rip]
        vbroadcasti128 ymm15, xmmword ptr [ROT8+rip]
        vpaddd ymm0, ymm0, ymm4
        vpaddd ymm0, ymm0, ymm1
        vpxord ymm3, ymm3, ymm0
        vpshufb ymm3, ymm3, ymm14
        vpaddd ymm2, ymm2, ymm3
        vpxord ymm1, ymm1, ymm2
        vpsrld ymm8, ymm1, 12
        vpslld ymm1, ymm1, 20
        vpor ymm1, ymm1, ymm8
        vpaddd ymm0, ymm0, ymm5
        vpaddd ymm0, ymm0, ymm1
        vpxord ymm3, ymm3, ymm0
        vpshufb ymm3, ymm3, ymm15
        vpaddd ymm2, ymm2, ymm3
        vpxord ymm1, ymm1, ymm2
        vpsrld ymm8, ymm1, 7
        vpslld ymm1, ymm1, 25
        vpor ymm1, ymm1, ymm8
        vpshufd ymm0, ymm0, 0x93
        vpshufd ymm3, ymm3, 0x4E
        vpshufd ymm2, ymm2, 0x39
        vpaddd ymm0, ymm0, ymm6
        vpaddd ymm0, ymm0, ymm1
        vpxord ymm3, ymm3, ymm0
        vpshufb ymm3, ymm3, ymm14
        vpaddd ymm2, ymm2, ymm3
        vpxord ymm1, ymm1, ymm2
        vpsrld ymm8, ymm1, 12
        vpslld ymm1, ymm1, 20
        vpor ymm1, ymm1, ymm8
        vpaddd ymm0, ymm0, ymm7
        vpaddd ymm0, ymm0, ymm1
        vpxord ymm3, ymm3, ymm0
        vpshufb ymm3, ymm3, ymm15
        vpaddd ymm2, ymm2, ymm3
        vpxord ymm1, ymm1, ymm2
        vpsrld ymm8, ymm1, 7
        vpslld ymm1, ymm1, 25
        vpor ymm1, ymm1, ymm8
        vpshufd ymm0, ymm0, 0x39
        vpshufd ymm3, ymm3, 0x4E
        vpshufd ymm2, ymm2, 0x93
        vshufps ymm8, ymm4, ymm5, 214
        vpshufd ymm9, ymm4, 0x0F
        vpshufd ymm4, ymm8, 0x39
        vshufps ymm8, ymm6, ymm7, 250
        vpblendd ymm9, ymm9, ymm8, 0xAA
        vpunpcklqdq ymm8, ymm7, ymm5
        vpblendd ymm8, ymm8, ymm6, 0x88
        vpshufd ymm8, ymm8, 0x78
        vpunpckhdq ymm5, ymm5, ymm7
        vpunpckldq ymm6, ymm6, ymm5
        vpshufd ymm7, ymm6, 0x1E
        vmovdqa ymm5, ymm9
        vmovdqa ymm6, ymm8
        vpaddd ymm0, ymm0, ymm4
        vpaddd ymm0, ymm0, ymm1
        vpxord ymm3, ymm3, ymm0
        vpshufb ymm3, ymm3, ymm14
        vpaddd ymm2, ymm2, ymm3
        vpxord ymm1, ymm1, ymm2
        vpsrld ymm8, ymm1, 12
        vpslld ymm1, ymm1, 20
        vpor ymm1, ymm1, ymm8
        vpaddd ymm0, ymm0, ymm5
        vpaddd ymm0, ymm0, ymm1
        vpxord ymm3, ymm3, ymm0
        vpshufb ymm3, ymm3, ymm15
        vpaddd ymm2, ymm2, ymm3
        vpxord ymm1, ymm1, ymm2
        vpsrld ymm8, ymm1, 7
        vpslld ymm1, ymm1, 25
        vpor ymm1, ymm1, ymm8
        vpshufd ymm0, ymm0, 0x93
        vpshufd ymm3, ymm3, 0x4E
        vpshufd ymm2, ymm2, 0x39
        vpaddd ymm0, ymm0, ymm6
        vpaddd ymm0, ymm0, ymm1
        vpxord ymm3, ymm3, ymm0
        vpshufb ymm3, ymm3, ymm14
        vpaddd ymm2, ymm2, ymm3
        vpxord ymm1, ymm1, ymm2
        vpsrld ymm8, ymm1, 12
        vpslld ymm1, ymm1, 20
        vpor ymm1, ymm1, ymm8
        vpaddd ymm0, ymm0, ymm7
        vpaddd ymm0, ymm0, ymm1
        vpxord ymm3, ymm3, ymm0
        vpshufb ymm3, ymm3, ymm15
        vpaddd ymm2, ymm2, ymm3
        vpxord ymm1, ymm1, ymm2
        vpsrld ymm8, ymm1, 7
        vpslld ymm1, ymm1, 25
        vpor ymm1, ymm1, ymm8
        vpshufd ymm0, ymm0, 0x39
        vpshufd ymm3, ymm3, 0x4E
        vpshufd ymm2, ymm2, 0x93
        vshufps ymm8, ymm4, ymm5, 214
        vpshufd ymm9, ymm4, 0x0F
        vpshufd ymm4, ymm8, 0x39
        vshufps ymm8, ymm6, ymm7, 250
        vpblendd ymm9, ymm9, ymm8, 0xAA
        vpunpcklqdq ymm8, ymm7, ymm5
        vpblendd ymm8, ymm8, ymm6, 0x88
        vpshufd ymm8, ymm8, 0x78
        vpunpckhdq ymm5, ymm5, ymm7
        vpunpckldq ymm6, ymm6, ymm5
        vpshufd ymm7, ymm6, 0x1E
        vmovdqa ymm5, ymm9
        vmovdqa ymm6, ymm8
        vpaddd ymm0, ymm0, ymm4
        vpaddd ymm0, ymm0, ymm1
        vpxord ymm3, ymm3, ymm0
        vpshufb ymm3, ymm3, ymm14
        vpaddd ymm2, ymm2, ymm3
        vpxord ymm1, ymm1, ymm2
        vpsrld ymm8, ymm1, 12
        vpslld ymm1, ymm1, 20
        vpor ymm1, ymm1, ymm8
        vpaddd ymm0, ymm0, ymm5
        vpaddd ymm0, ymm0, ymm1
        vpxord ymm3, ymm3, ymm0
        vpshufb ymm3, ymm3, ymm15
        vpaddd ymm2, ymm2, ymm3
        vpxord ymm1, ymm1, ymm2
        vpsrld ymm8, ymm1, 7
        vpslld ymm1, ymm1, 25
        vpor ymm1, ymm1, ymm8
        vpshufd ymm0, ymm0, 0x93
        vpshufd ymm3, ymm3, 0x4E
        vpshufd ymm2, ymm2, 0x39
        vpaddd ymm0, ymm0, ymm6
        vpaddd ymm0, ymm0, ymm1
        vpxord ymm3, ymm3, ymm0
        vpshufb ymm3, ymm3, ymm14
        vpaddd ymm2, ymm2, ymm3
        vpxord ymm1, ymm1, ymm2
        vpsrld ymm8, ymm1, 12
        vpslld ymm1, ymm1, 20
        vpor ymm1, ymm1, ymm8
        vpaddd ymm0, ymm0, ymm7
        vpaddd ymm0, ymm0, ymm1
        vpxord ymm3, ymm3, ymm0
        vpshufb ymm3, ymm3, ymm15
        vpaddd ymm2, ymm2, ymm3
        vpxord ymm1, ymm1, ymm2
        vpsrld ymm8, ymm1, 7
        vpslld ymm1, ymm1, 25
        vpor ymm1, ymm1, ymm8
        vpshufd ymm0, ymm0, 0x39
        vpshufd ymm3, ymm3, 0x4E
        vpshufd ymm2, ymm2, 0x93
        vshufps ymm8, ymm4, ymm5, 214
        vpshufd ymm9, ymm4, 0x0F
        vpshufd ymm4, ymm8, 0x39
        vshufps ymm8, ymm6, ymm7, 250
        vpblendd ymm9, ymm9, ymm8, 0xAA
        vpunpcklqdq ymm8, ymm7, ymm5
        vpblendd ymm8, ymm8, ymm6, 0x88
        vpshufd ymm8, ymm8, 0x78
        vpunpckhdq ymm5, ymm5, ymm7
        vpunpckldq ymm6, ymm6, ymm5
        vpshufd ymm7, ymm6, 0x1E
        vmovdqa ymm5, ymm9
        vmovdqa ymm6, ymm8
        vpaddd ymm0, ymm0, ymm4
        vpaddd ymm0, ymm0, ymm1
        vpxord ymm3, ymm3, ymm0
        vpshufb ymm3, ymm3, ymm14
        vpaddd ymm2, ymm2, ymm3
        vpxord ymm1, ymm1, ymm2
        vpsrld ymm8, ymm1, 12
        vpslld ymm1, ymm1, 20
        vpor ymm1, ymm1, ymm8
        vpaddd ymm0, ymm0, ymm5
        vpaddd ymm0, ymm0, ymm1
        vpxord ymm3, ymm3, ymm0
        vpshufb ymm3, ymm3, ymm15
        vpaddd ymm2, ymm2, ymm3
        vpxord ymm1, ymm1, ymm2
        vpsrld ymm8, ymm1, 7
        vpslld ymm1, ymm1, 25
        vpor ymm1, ymm1, ymm8
        vpshufd ymm0, ymm0, 0x93
        vpshufd ymm3, ymm3, 0x4E
        vpshufd ymm2, ymm2, 0x39
        vpaddd ymm0, ymm0, ymm6
        vpaddd ymm0, ymm0, ymm1
        vpxord ymm3, ymm3, ymm0
        vpshufb ymm3, ymm3, ymm14
        vpaddd ymm2, ymm2, ymm3
        vpxord ymm1, ymm1, ymm2
        vpsrld ymm8, ymm1, 12
        vpslld ymm1, ymm1, 20
        vpor ymm1, ymm1, ymm8
        vpaddd ymm0, ymm0, ymm7
        vpaddd ymm0, ymm0, ymm1
        vpxord ymm3, ymm3, ymm0
        vpshufb ymm3, ymm3, ymm15
        vpaddd ymm2, ymm2, ymm3
        vpxord ymm1, ymm1, ymm2
        vpsrld ymm8, ymm1, 7
        vpslld ymm1, ymm1, 25
        vpor ymm1, ymm1, ymm8
        vpshufd ymm0, ymm0, 0x39
        vpshufd ymm3, ymm3, 0x4E
        vpshufd ymm2, ymm2, 0x93
        vshufps ymm8, ymm4, ymm5, 214
        vpshufd ymm9, ymm4, 0x0F
        vpshufd ymm4, ymm8, 0x39
        vshufps ymm8, ymm6, ymm7, 250
        vpblendd ymm9, ymm9, ymm8, 0xAA
        vpunpcklqdq ymm8, ymm7, ymm5
        vpblendd ymm8, ymm8, ymm6, 0x88
        vpshufd ymm8, ymm8, 0x78
        vpunpckhdq ymm5, ymm5, ymm7
        vpunpckldq ymm6, ymm6, ymm5
        vpshufd ymm7, ymm6, 0x1E
        vmovdqa ymm5, ymm9
        vmovdqa ymm6, ymm8
        vpaddd ymm0, ymm0, ymm4
        vpaddd ymm0, ymm0, ymm1
        vpxord ymm3, ymm3, ymm0
        vpshufb ymm3, ymm3, ymm14
        vpaddd ymm2, ymm2, ymm3
        vpxord ymm1, ymm1, ymm2
        vpsrld ymm8, ymm1, 12
        vpslld ymm1, ymm1, 20
        vpor ymm1, ymm1, ymm8
        vpaddd ymm0, ymm0, ymm5
        vpaddd ymm0, ymm0, ymm1
        vpxord ymm3, ymm3, ymm0
        vpshufb ymm3, ymm3, ymm15
        vpaddd ymm2, ymm2, ymm3
        vpxord ymm1, ymm1, ymm2
        vpsrld ymm8, ymm1, 7
        vpslld ymm1, ymm1, 25
        vpor ymm1, ymm1, ymm8
        vpshufd ymm0, ymm0, 0x93
        vpshufd ymm3, ymm3, 0x4E
        vpshufd ymm2, ymm2, 0x39
        vpaddd ymm0, ymm0, ymm6
        vpaddd ymm0, ymm0, ymm1
        vpxord ymm3, ymm3, ymm0
        vpshufb ymm3, ymm3, ymm14
        vpaddd ymm2, ymm2, ymm3
        vpxord ymm1, ymm1, ymm2
        vpsrld ymm8, ymm1, 12
        vpslld ymm1, ymm1, 20
        vpor ymm1, ymm1, ymm8
        vpaddd ymm0, ymm0, ymm7
        vpaddd ymm0, ymm0, ymm1
        vpxord ymm3, ymm3, ymm0
        vpshufb ymm3, ymm3, ymm15
        vpaddd ymm2, ymm2, ymm3
        vpxord ymm1, ymm1, ymm2
        vpsrld ymm8, ymm1, 7
        vpslld ymm1, ymm1, 25
        vpor ymm1, ymm1, ymm8
        vpshufd ymm0, ymm0, 0x39
        vpshufd ymm3, ymm3, 0x4E
        vpshufd ymm2, ymm2, 0x93
        vshufps ymm8, ymm4, ymm5, 214
        vpshufd ymm9, ymm4, 0x0F
        vpshufd ymm4, ymm8, 0x39
        vshufps ymm8, ymm6, ymm7, 250
        vpblendd ymm9, ymm9, ymm8, 0xAA
        vpunpcklqdq ymm8, ymm7, ymm5
        vpblendd ymm8, ymm8, ymm6, 0x88
        vpshufd ymm8, ymm8, 0x78
        vpunpckhdq ymm5, ymm5, ymm7
        vpunpckldq ymm6, ymm6, ymm5
        vpshufd ymm7, ymm6, 0x1E
        vmovdqa ymm5, ymm9
        vmovdqa ymm6, ymm8
        vpaddd ymm0, ymm0, ymm4
        vpaddd ymm0, ymm0, ymm1
        vpxord ymm3, ymm3, ymm0
        vpshufb ymm3, ymm3, ymm14
        vpaddd ymm2, ymm2, ymm3
        vpxord ymm1, ymm1, ymm2
        vpsrld ymm8, ymm1, 12
        vpslld ymm1, ymm1, 20
        vpor ymm1, ymm1, ymm8
        vpaddd ymm0, ymm0, ymm5
        vpaddd ymm0, ymm0, ymm1
        vpxord ymm3, ymm3, ymm0
        vpshufb ymm3, ymm3, ymm15
        vpaddd ymm2, ymm2, ymm3
        vpxord ymm1, ymm1, ymm2
        vpsrld ymm8, ymm1, 7
        vpslld ymm1, ymm1, 25
        vpor ymm1, ymm1, ymm8
        vpshufd ymm0, ymm0, 0x93
        vpshufd ymm3, ymm3, 0x4E
        vpshufd ymm2, ymm2, 0x39
        vpaddd ymm0, ymm0, ymm6
        vpaddd ymm0, ymm0, ymm1
        vpxord ymm3, ymm3, ymm0
        vpshufb ymm3, ymm3, ymm14
        vpaddd ymm2, ymm2, ymm3
        vpxord ymm1, ymm1, ymm2
        vpsrld ymm8, ymm1, 12
        vpslld ymm1, ymm1, 20
        vpor ymm1, ymm1, ymm8
        vpaddd ymm0, ymm0, ymm7
        vpaddd ymm0, ymm0, ymm1
        vpxord ymm3, ymm3, ymm0
        vpshufb ymm3, ymm3, ymm15
        vpaddd ymm2, ymm2, ymm3
        vpxord ymm1, ymm1, ymm2
        vpsrld ymm8, ymm1, 7
        vpslld ymm1, ymm1, 25
        vpor ymm1, ymm1, ymm8
        vpshufd ymm0, ymm0, 0x39
        vpshufd ymm3, ymm3, 0x4E
        vpshufd ymm2, ymm2, 0x93
        vshufps ymm8, ymm4, ymm5, 214
        vpshufd ymm9, ymm4, 0x0F
        vpshufd ymm4, ymm8, 0x39
        vshufps ymm8, ymm6, ymm7, 250
        vpblendd ymm9, ymm9, ymm8, 0xAA
        vpunpcklqdq ymm8, ymm7, ymm5
        vpblendd ymm8, ymm8, ymm6, 0x88
        vpshufd ymm8, ymm8, 0x78
        vpunpckhdq ymm5, ymm5, ymm7
        vpunpckldq ymm6, ymm6, ymm5
        vpshufd ymm7, ymm6, 0x1E
        vmovdqa ymm5, ymm9
        vmovdqa ymm6, ymm8
        vpaddd ymm0, ymm0, ymm4
        vpaddd ymm0, ymm0, ymm1
        vpxord ymm3, ymm3, ymm0
        vpshufb ymm3, ymm3, ymm14
        vpaddd ymm2, ymm2, ymm3
        vpxord ymm1, ymm1, ymm2
        vpsrld ymm8, ymm1, 12
        vpslld ymm1, ymm1, 20
        vpor ymm1, ymm1, ymm8
        vpaddd ymm0, ymm0, ymm5
        vpaddd ymm0, ymm0, ymm1
        vpxord ymm3, ymm3, ymm0
        vpshufb ymm3, ymm3, ymm15
        vpaddd ymm2, ymm2, ymm3
        vpxord ymm1, ymm1, ymm2
        vpsrld ymm8, ymm1, 7
        vpslld ymm1, ymm1, 25
        vpor ymm1, ymm1, ymm8
        vpshufd ymm0, ymm0, 0x93
        vpshufd ymm3, ymm3, 0x4E
        vpshufd ymm2, ymm2, 0x39
        vpaddd ymm0, ymm0, ymm6
        vpaddd ymm0, ymm0, ymm1
        vpxord ymm3, ymm3, ymm0
        vpshufb ymm3, ymm3, ymm14
        vpaddd ymm2, ymm2, ymm3
        vpxord ymm1, ymm1, ymm2
        vpsrld ymm8, ymm1, 12
        vpslld ymm1, ymm1, 20
        vpor ymm1, ymm1, ymm8
        vpaddd ymm0, ymm0, ymm7
        vpaddd ymm0, ymm0, ymm1
        vpxord ymm3, ymm3, ymm0
        vpshufb ymm3, ymm3, ymm15
        vpaddd ymm2, ymm2, ymm3
        vpxord ymm1, ymm1, ymm2
        vpsrld ymm8, ymm1, 7
        vpslld ymm1, ymm1, 25
        vpor ymm1, ymm1, ymm8
        vpshufd ymm0, ymm0, 0x39
        vpshufd ymm3, ymm3, 0x4E
        vpshufd ymm2, ymm2, 0x93
        vpxord ymm0, ymm0, ymm2
        vpxord ymm1, ymm1, ymm3
        ret
blake3_avx512_kernel2d_1:
        vpaddd xmm0, xmm0, xmm4
        vpaddd xmm0, xmm0, xmm1
        vpxord xmm3, xmm3, xmm0
        vprord xmm3, xmm3, 16
        vpaddd xmm2, xmm2, xmm3
        vpxord xmm1, xmm1, xmm2
        vprord xmm1, xmm1, 12
        vpaddd xmm0, xmm0, xmm5
        vpaddd xmm0, xmm0, xmm1
        vpxord xmm3, xmm3, xmm0
        vprord xmm3, xmm3, 8
        vpaddd xmm2, xmm2, xmm3
        vpxord xmm1, xmm1, xmm2
        vprord xmm1, xmm1, 7
        vpshufd xmm0, xmm0, 0x93
        vpshufd xmm3, xmm3, 0x4E
        vpshufd xmm2, xmm2, 0x39
        vpaddd xmm0, xmm0, xmm6
        vpaddd xmm0, xmm0, xmm1
        vpxord xmm3, xmm3, xmm0
        vprord xmm3, xmm3, 16
        vpaddd xmm2, xmm2, xmm3
        vpxord xmm1, xmm1, xmm2
        vprord xmm1, xmm1, 12
        vpaddd xmm0, xmm0, xmm7
        vpaddd xmm0, xmm0, xmm1
        vpxord xmm3, xmm3, xmm0
        vprord xmm3, xmm3, 8
        vpaddd xmm2, xmm2, xmm3
        vpxord xmm1, xmm1, xmm2
        vprord xmm1, xmm1, 7
        vpshufd xmm0, xmm0, 0x39
        vpshufd xmm3, xmm3, 0x4E
        vpshufd xmm2, xmm2, 0x93
        vshufps xmm8, xmm4, xmm5, 214
        vpshufd xmm9, xmm4, 0x0F
        vpshufd xmm4, xmm8, 0x39
        vshufps xmm8, xmm6, xmm7, 250
        vpblendd xmm9, xmm9, xmm8, 0xAA
        vpunpcklqdq xmm8, xmm7, xmm5
        vpblendd xmm8, xmm8, xmm6, 0x88
        vpshufd xmm8, xmm8, 0x78
        vpunpckhdq xmm5, xmm5, xmm7
        vpunpckldq xmm6, xmm6, xmm5
        vpshufd xmm7, xmm6, 0x1E
        vmovdqa xmm5, xmm9
        vmovdqa xmm6, xmm8
        vpaddd xmm0, xmm0, xmm4
        vpaddd xmm0, xmm0, xmm1
        vpxord xmm3, xmm3, xmm0
        vprord xmm3, xmm3, 16
        vpaddd xmm2, xmm2, xmm3
        vpxord xmm1, xmm1, xmm2
        vprord xmm1, xmm1, 12
        vpaddd xmm0, xmm0, xmm5
        vpaddd xmm0, xmm0, xmm1
        vpxord xmm3, xmm3, xmm0
        vprord xmm3, xmm3, 8
        vpaddd xmm2, xmm2, xmm3
        vpxord xmm1, xmm1, xmm2
        vprord xmm1, xmm1, 7
        vpshufd xmm0, xmm0, 0x93
        vpshufd xmm3, xmm3, 0x4E
        vpshufd xmm2, xmm2, 0x39
        vpaddd xmm0, xmm0, xmm6
        vpaddd xmm0, xmm0, xmm1
        vpxord xmm3, xmm3, xmm0
        vprord xmm3, xmm3, 16
        vpaddd xmm2, xmm2, xmm3
        vpxord xmm1, xmm1, xmm2
        vprord xmm1, xmm1, 12
        vpaddd xmm0, xmm0, xmm7
        vpaddd xmm0, xmm0, xmm1
        vpxord xmm3, xmm3, xmm0
        vprord xmm3, xmm3, 8
        vpaddd xmm2, xmm2, xmm3
        vpxord xmm1, xmm1, xmm2
        vprord xmm1, xmm1, 7
        vpshufd xmm0, xmm0, 0x39
        vpshufd xmm3, xmm3, 0x4E
        vpshufd xmm2, xmm2, 0x93
        vshufps xmm8, xmm4, xmm5, 214
        vpshufd xmm9, xmm4, 0x0F
        vpshufd xmm4, xmm8, 0x39
        vshufps xmm8, xmm6, xmm7, 250
        vpblendd xmm9, xmm9, xmm8, 0xAA
        vpunpcklqdq xmm8, xmm7, xmm5
        vpblendd xmm8, xmm8, xmm6, 0x88
        vpshufd xmm8, xmm8, 0x78
        vpunpckhdq xmm5, xmm5, xmm7
        vpunpckldq xmm6, xmm6, xmm5
        vpshufd xmm7, xmm6, 0x1E
        vmovdqa xmm5, xmm9
        vmovdqa xmm6, xmm8
        vpaddd xmm0, xmm0, xmm4
        vpaddd xmm0, xmm0, xmm1
        vpxord xmm3, xmm3, xmm0
        vprord xmm3, xmm3, 16
        vpaddd xmm2, xmm2, xmm3
        vpxord xmm1, xmm1, xmm2
        vprord xmm1, xmm1, 12
        vpaddd xmm0, xmm0, xmm5
        vpaddd xmm0, xmm0, xmm1
        vpxord xmm3, xmm3, xmm0
        vprord xmm3, xmm3, 8
        vpaddd xmm2, xmm2, xmm3
        vpxord xmm1, xmm1, xmm2
        vprord xmm1, xmm1, 7
        vpshufd xmm0, xmm0, 0x93
        vpshufd xmm3, xmm3, 0x4E
        vpshufd xmm2, xmm2, 0x39
        vpaddd xmm0, xmm0, xmm6
        vpaddd xmm0, xmm0, xmm1
        vpxord xmm3, xmm3, xmm0
        vprord xmm3, xmm3, 16
        vpaddd xmm2, xmm2, xmm3
        vpxord xmm1, xmm1, xmm2
        vprord xmm1, xmm1, 12
        vpaddd xmm0, xmm0, xmm7
        vpaddd xmm0, xmm0, xmm1
        vpxord xmm3, xmm3, xmm0
        vprord xmm3, xmm3, 8
        vpaddd xmm2, xmm2, xmm3
        vpxord xmm1, xmm1, xmm2
        vprord xmm1, xmm1, 7
        vpshufd xmm0, xmm0, 0x39
        vpshufd xmm3, xmm3, 0x4E
        vpshufd xmm2, xmm2, 0x93
        vshufps xmm8, xmm4, xmm5, 214
        vpshufd xmm9, xmm4, 0x0F
        vpshufd xmm4, xmm8, 0x39
        vshufps xmm8, xmm6, xmm7, 250
        vpblendd xmm9, xmm9, xmm8, 0xAA
        vpunpcklqdq xmm8, xmm7, xmm5
        vpblendd xmm8, xmm8, xmm6, 0x88
        vpshufd xmm8, xmm8, 0x78
        vpunpckhdq xmm5, xmm5, xmm7
        vpunpckldq xmm6, xmm6, xmm5
        vpshufd xmm7, xmm6, 0x1E
        vmovdqa xmm5, xmm9
        vmovdqa xmm6, xmm8
        vpaddd xmm0, xmm0, xmm4
        vpaddd xmm0, xmm0, xmm1
        vpxord xmm3, xmm3, xmm0
        vprord xmm3, xmm3, 16
        vpaddd xmm2, xmm2, xmm3
        vpxord xmm1, xmm1, xmm2
        vprord xmm1, xmm1, 12
        vpaddd xmm0, xmm0, xmm5
        vpaddd xmm0, xmm0, xmm1
        vpxord xmm3, xmm3, xmm0
        vprord xmm3, xmm3, 8
        vpaddd xmm2, xmm2, xmm3
        vpxord xmm1, xmm1, xmm2
        vprord xmm1, xmm1, 7
        vpshufd xmm0, xmm0, 0x93
        vpshufd xmm3, xmm3, 0x4E
        vpshufd xmm2, xmm2, 0x39
        vpaddd xmm0, xmm0, xmm6
        vpaddd xmm0, xmm0, xmm1
        vpxord xmm3, xmm3, xmm0
        vprord xmm3, xmm3, 16
        vpaddd xmm2, xmm2, xmm3
        vpxord xmm1, xmm1, xmm2
        vprord xmm1, xmm1, 12
        vpaddd xmm0, xmm0, xmm7
        vpaddd xmm0, xmm0, xmm1
        vpxord xmm3, xmm3, xmm0
        vprord xmm3, xmm3, 8
        vpaddd xmm2, xmm2, xmm3
        vpxord xmm1, xmm1, xmm2
        vprord xmm1, xmm1, 7
        vpshufd xmm0, xmm0, 0x39
        vpshufd xmm3, xmm3, 0x4E
        vpshufd xmm2, xmm2, 0x93
        vshufps xmm8, xmm4, xmm5, 214
        vpshufd xmm9, xmm4, 0x0F
        vpshufd xmm4, xmm8, 0x39
        vshufps xmm8, xmm6, xmm7, 250
        vpblendd xmm9, xmm9, xmm8, 0xAA
        vpunpcklqdq xmm8, xmm7, xmm5
        vpblendd xmm8, xmm8, xmm6, 0x88
        vpshufd xmm8, xmm8, 0x78
        vpunpckhdq xmm5, xmm5, xmm7
        vpunpckldq xmm6, xmm6, xmm5
        vpshufd xmm7, xmm6, 0x1E
        vmovdqa xmm5, xmm9
        vmovdqa xmm6, xmm8
        vpaddd xmm0, xmm0, xmm4
        vpaddd xmm0, xmm0, xmm1
        vpxord xmm3, xmm3, xmm0
        vprord xmm3, xmm3, 16
        vpaddd xmm2, xmm2, xmm3
        vpxord xmm1, xmm1, xmm2
        vprord xmm1, xmm1, 12
        vpaddd xmm0, xmm0, xmm5
        vpaddd xmm0, xmm0, xmm1
        vpxord xmm3, xmm3, xmm0
        vprord xmm3, xmm3, 8
        vpaddd xmm2, xmm2, xmm3
        vpxord xmm1, xmm1, xmm2
        vprord xmm1, xmm1, 7
        vpshufd xmm0, xmm0, 0x93
        vpshufd xmm3, xmm3, 0x4E
        vpshufd xmm2, xmm2, 0x39
        vpaddd xmm0, xmm0, xmm6
        vpaddd xmm0, xmm0, xmm1
        vpxord xmm3, xmm3, xmm0
        vprord xmm3, xmm3, 16
        vpaddd xmm2, xmm2, xmm3
        vpxord xmm1, xmm1, xmm2
        vprord xmm1, xmm1, 12
        vpaddd xmm0, xmm0, xmm7
        vpaddd xmm0, xmm0, xmm1
        vpxord xmm3, xmm3, xmm0
        vprord xmm3, xmm3, 8
        vpaddd xmm2, xmm2, xmm3
        vpxord xmm1, xmm1, xmm2
        vprord xmm1, xmm1, 7
        vpshufd xmm0, xmm0, 0x39
        vpshufd xmm3, xmm3, 0x4E
        vpshufd xmm2, xmm2, 0x93
        vshufps xmm8, xmm4, xmm5, 214
        vpshufd xmm9, xmm4, 0x0F
        vpshufd xmm4, xmm8, 0x39
        vshufps xmm8, xmm6, xmm7, 250
        vpblendd xmm9, xmm9, xmm8, 0xAA
        vpunpcklqdq xmm8, xmm7, xmm5
        vpblendd xmm8, xmm8, xmm6, 0x88
        vpshufd xmm8, xmm8, 0x78
        vpunpckhdq xmm5, xmm5, xmm7
        vpunpckldq xmm6, xmm6, xmm5
        vpshufd xmm7, xmm6, 0x1E
        vmovdqa xmm5, xmm9
        vmovdqa xmm6, xmm8
        vpaddd xmm0, xmm0, xmm4
        vpaddd xmm0, xmm0, xmm1
        vpxord xmm3, xmm3, xmm0
        vprord xmm3, xmm3, 16
        vpaddd xmm2, xmm2, xmm3
        vpxord xmm1, xmm1, xmm2
        vprord xmm1, xmm1, 12
        vpaddd xmm0, xmm0, xmm5
        vpaddd xmm0, xmm0, xmm1
        vpxord xmm3, xmm3, xmm0
        vprord xmm3, xmm3, 8
        vpaddd xmm2, xmm2, xmm3
        vpxord xmm1, xmm1, xmm2
        vprord xmm1, xmm1, 7
        vpshufd xmm0, xmm0, 0x93
        vpshufd xmm3, xmm3, 0x4E
        vpshufd xmm2, xmm2, 0x39
        vpaddd xmm0, xmm0, xmm6
        vpaddd xmm0, xmm0, xmm1
        vpxord xmm3, xmm3, xmm0
        vprord xmm3, xmm3, 16
        vpaddd xmm2, xmm2, xmm3
        vpxord xmm1, xmm1, xmm2
        vprord xmm1, xmm1, 12
        vpaddd xmm0, xmm0, xmm7
        vpaddd xmm0, xmm0, xmm1
        vpxord xmm3, xmm3, xmm0
        vprord xmm3, xmm3, 8
        vpaddd xmm2, xmm2, xmm3
        vpxord xmm1, xmm1, xmm2
        vprord xmm1, xmm1, 7
        vpshufd xmm0, xmm0, 0x39
        vpshufd xmm3, xmm3, 0x4E
        vpshufd xmm2, xmm2, 0x93
        vshufps xmm8, xmm4, xmm5, 214
        vpshufd xmm9, xmm4, 0x0F
        vpshufd xmm4, xmm8, 0x39
        vshufps xmm8, xmm6, xmm7, 250
        vpblendd xmm9, xmm9, xmm8, 0xAA
        vpunpcklqdq xmm8, xmm7, xmm5
        vpblendd xmm8, xmm8, xmm6, 0x88
        vpshufd xmm8, xmm8, 0x78
        vpunpckhdq xmm5, xmm5, xmm7
        vpunpckldq xmm6, xmm6, xmm5
        vpshufd xmm7, xmm6, 0x1E
        vmovdqa xmm5, xmm9
        vmovdqa xmm6, xmm8
        vpaddd xmm0, xmm0, xmm4
        vpaddd xmm0, xmm0, xmm1
        vpxord xmm3, xmm3, xmm0
        vprord xmm3, xmm3, 16
        vpaddd xmm2, xmm2, xmm3
        vpxord xmm1, xmm1, xmm2
        vprord xmm1, xmm1, 12
        vpaddd xmm0, xmm0, xmm5
        vpaddd xmm0, xmm0, xmm1
        vpxord xmm3, xmm3, xmm0
        vprord xmm3, xmm3, 8
        vpaddd xmm2, xmm2, xmm3
        vpxord xmm1, xmm1, xmm2
        vprord xmm1, xmm1, 7
        vpshufd xmm0, xmm0, 0x93
        vpshufd xmm3, xmm3, 0x4E
        vpshufd xmm2, xmm2, 0x39
        vpaddd xmm0, xmm0, xmm6
        vpaddd xmm0, xmm0, xmm1
        vpxord xmm3, xmm3, xmm0
        vprord xmm3, xmm3, 16
        vpaddd xmm2, xmm2, xmm3
        vpxord xmm1, xmm1, xmm2
        vprord xmm1, xmm1, 12
        vpaddd xmm0, xmm0, xmm7
        vpaddd xmm0, xmm0, xmm1
        vpxord xmm3, xmm3, xmm0
        vprord xmm3, xmm3, 8
        vpaddd xmm2, xmm2, xmm3
        vpxord xmm1, xmm1, xmm2
        vprord xmm1, xmm1, 7
        vpshufd xmm0, xmm0, 0x39
        vpshufd xmm3, xmm3, 0x4E
        vpshufd xmm2, xmm2, 0x93
        vpxord xmm0, xmm0, xmm2
        vpxord xmm1, xmm1, xmm3
        ret
blake3_avx512_kernel2d_2:
        vpaddd ymm0, ymm0, ymm4
        vpaddd ymm0, ymm0, ymm1
        vpxord ymm3, ymm3, ymm0
        vprord ymm3, ymm3, 16
        vpaddd ymm2, ymm2, ymm3
        vpxord ymm1, ymm1, ymm2
        vprord ymm1, ymm1, 12
        vpaddd ymm0, ymm0, ymm5
        vpaddd ymm0, ymm0, ymm1
        vpxord ymm3, ymm3, ymm0
        vprord ymm3, ymm3, 8
        vpaddd ymm2, ymm2, ymm3
        vpxord ymm1, ymm1, ymm2
        vprord ymm1, ymm1, 7
        vpshufd ymm0, ymm0, 0x93
        vpshufd ymm3, ymm3, 0x4E
        vpshufd ymm2, ymm2, 0x39
        vpaddd ymm0, ymm0, ymm6
        vpaddd ymm0, ymm0, ymm1
        vpxord ymm3, ymm3, ymm0
        vprord ymm3, ymm3, 16
        vpaddd ymm2, ymm2, ymm3
        vpxord ymm1, ymm1, ymm2
        vprord ymm1, ymm1, 12
        vpaddd ymm0, ymm0, ymm7
        vpaddd ymm0, ymm0, ymm1
        vpxord ymm3, ymm3, ymm0
        vprord ymm3, ymm3, 8
        vpaddd ymm2, ymm2, ymm3
        vpxord ymm1, ymm1, ymm2
        vprord ymm1, ymm1, 7
        vpshufd ymm0, ymm0, 0x39
        vpshufd ymm3, ymm3, 0x4E
        vpshufd ymm2, ymm2, 0x93
        vshufps ymm8, ymm4, ymm5, 214
        vpshufd ymm9, ymm4, 0x0F
        vpshufd ymm4, ymm8, 0x39
        vshufps ymm8, ymm6, ymm7, 250
        vpblendd ymm9, ymm9, ymm8, 0xAA
        vpunpcklqdq ymm8, ymm7, ymm5
        vpblendd ymm8, ymm8, ymm6, 0x88
        vpshufd ymm8, ymm8, 0x78
        vpunpckhdq ymm5, ymm5, ymm7
        vpunpckldq ymm6, ymm6, ymm5
        vpshufd ymm7, ymm6, 0x1E
        vmovdqa ymm5, ymm9
        vmovdqa ymm6, ymm8
        vpaddd ymm0, ymm0, ymm4
        vpaddd ymm0, ymm0, ymm1
        vpxord ymm3, ymm3, ymm0
        vprord ymm3, ymm3, 16
        vpaddd ymm2, ymm2, ymm3
        vpxord ymm1, ymm1, ymm2
        vprord ymm1, ymm1, 12
        vpaddd ymm0, ymm0, ymm5
        vpaddd ymm0, ymm0, ymm1
        vpxord ymm3, ymm3, ymm0
        vprord ymm3, ymm3, 8
        vpaddd ymm2, ymm2, ymm3
        vpxord ymm1, ymm1, ymm2
        vprord ymm1, ymm1, 7
        vpshufd ymm0, ymm0, 0x93
        vpshufd ymm3, ymm3, 0x4E
        vpshufd ymm2, ymm2, 0x39
        vpaddd ymm0, ymm0, ymm6
        vpaddd ymm0, ymm0, ymm1
        vpxord ymm3, ymm3, ymm0
        vprord ymm3, ymm3, 16
        vpaddd ymm2, ymm2, ymm3
        vpxord ymm1, ymm1, ymm2
        vprord ymm1, ymm1, 12
        vpaddd ymm0, ymm0, ymm7
        vpaddd ymm0, ymm0, ymm1
        vpxord ymm3, ymm3, ymm0
        vprord ymm3, ymm3, 8
        vpaddd ymm2, ymm2, ymm3
        vpxord ymm1, ymm1, ymm2
        vprord ymm1, ymm1, 7
        vpshufd ymm0, ymm0, 0x39
        vpshufd ymm3, ymm3, 0x4E
        vpshufd ymm2, ymm2, 0x93
        vshufps ymm8, ymm4, ymm5, 214
        vpshufd ymm9, ymm4, 0x0F
        vpshufd ymm4, ymm8, 0x39
        vshufps ymm8, ymm6, ymm7, 250
        vpblendd ymm9, ymm9, ymm8, 0xAA
        vpunpcklqdq ymm8, ymm7, ymm5
        vpblendd ymm8, ymm8, ymm6, 0x88
        vpshufd ymm8, ymm8, 0x78
        vpunpckhdq ymm5, ymm5, ymm7
        vpunpckldq ymm6, ymm6, ymm5
        vpshufd ymm7, ymm6, 0x1E
        vmovdqa ymm5, ymm9
        vmovdqa ymm6, ymm8
        vpaddd ymm0, ymm0, ymm4
        vpaddd ymm0, ymm0, ymm1
        vpxord ymm3, ymm3, ymm0
        vprord ymm3, ymm3, 16
        vpaddd ymm2, ymm2, ymm3
        vpxord ymm1, ymm1, ymm2
        vprord ymm1, ymm1, 12
        vpaddd ymm0, ymm0, ymm5
        vpaddd ymm0, ymm0, ymm1
        vpxord ymm3, ymm3, ymm0
        vprord ymm3, ymm3, 8
        vpaddd ymm2, ymm2, ymm3
        vpxord ymm1, ymm1, ymm2
        vprord ymm1, ymm1, 7
        vpshufd ymm0, ymm0, 0x93
        vpshufd ymm3, ymm3, 0x4E
        vpshufd ymm2, ymm2, 0x39
        vpaddd ymm0, ymm0, ymm6
        vpaddd ymm0, ymm0, ymm1
        vpxord ymm3, ymm3, ymm0
        vprord ymm3, ymm3, 16
        vpaddd ymm2, ymm2, ymm3
        vpxord ymm1, ymm1, ymm2
        vprord ymm1, ymm1, 12
        vpaddd ymm0, ymm0, ymm7
        vpaddd ymm0, ymm0, ymm1
        vpxord ymm3, ymm3, ymm0
        vprord ymm3, ymm3, 8
        vpaddd ymm2, ymm2, ymm3
        vpxord ymm1, ymm1, ymm2
        vprord ymm1, ymm1, 7
        vpshufd ymm0, ymm0, 0x39
        vpshufd ymm3, ymm3, 0x4E
        vpshufd ymm2, ymm2, 0x93
        vshufps ymm8, ymm4, ymm5, 214
        vpshufd ymm9, ymm4, 0x0F
        vpshufd ymm4, ymm8, 0x39
        vshufps ymm8, ymm6, ymm7, 250
        vpblendd ymm9, ymm9, ymm8, 0xAA
        vpunpcklqdq ymm8, ymm7, ymm5
        vpblendd ymm8, ymm8, ymm6, 0x88
        vpshufd ymm8, ymm8, 0x78
        vpunpckhdq ymm5, ymm5, ymm7
        vpunpckldq ymm6, ymm6, ymm5
        vpshufd ymm7, ymm6, 0x1E
        vmovdqa ymm5, ymm9
        vmovdqa ymm6, ymm8
        vpaddd ymm0, ymm0, ymm4
        vpaddd ymm0, ymm0, ymm1
        vpxord ymm3, ymm3, ymm0
        vprord ymm3, ymm3, 16
        vpaddd ymm2, ymm2, ymm3
        vpxord ymm1, ymm1, ymm2
        vprord ymm1, ymm1, 12
        vpaddd ymm0, ymm0, ymm5
        vpaddd ymm0, ymm0, ymm1
        vpxord ymm3, ymm3, ymm0
        vprord ymm3, ymm3, 8
        vpaddd ymm2, ymm2, ymm3
        vpxord ymm1, ymm1, ymm2
        vprord ymm1, ymm1, 7
        vpshufd ymm0, ymm0, 0x93
        vpshufd ymm3, ymm3, 0x4E
        vpshufd ymm2, ymm2, 0x39
        vpaddd ymm0, ymm0, ymm6
        vpaddd ymm0, ymm0, ymm1
        vpxord ymm3, ymm3, ymm0
        vprord ymm3, ymm3, 16
        vpaddd ymm2, ymm2, ymm3
        vpxord ymm1, ymm1, ymm2
        vprord ymm1, ymm1, 12
        vpaddd ymm0, ymm0, ymm7
        vpaddd ymm0, ymm0, ymm1
        vpxord ymm3, ymm3, ymm0
        vprord ymm3, ymm3, 8
        vpaddd ymm2, ymm2, ymm3
        vpxord ymm1, ymm1, ymm2
        vprord ymm1, ymm1, 7
        vpshufd ymm0, ymm0, 0x39
        vpshufd ymm3, ymm3, 0x4E
        vpshufd ymm2, ymm2, 0x93
        vshufps ymm8, ymm4, ymm5, 214
        vpshufd ymm9, ymm4, 0x0F
        vpshufd ymm4, ymm8, 0x39
        vshufps ymm8, ymm6, ymm7, 250
        vpblendd ymm9, ymm9, ymm8, 0xAA
        vpunpcklqdq ymm8, ymm7, ymm5
        vpblendd ymm8, ymm8, ymm6, 0x88
        vpshufd ymm8, ymm8, 0x78
        vpunpckhdq ymm5, ymm5, ymm7
        vpunpckldq ymm6, ymm6, ymm5
        vpshufd ymm7, ymm6, 0x1E
        vmovdqa ymm5, ymm9
        vmovdqa ymm6, ymm8
        vpaddd ymm0, ymm0, ymm4
        vpaddd ymm0, ymm0, ymm1
        vpxord ymm3, ymm3, ymm0
        vprord ymm3, ymm3, 16
        vpaddd ymm2, ymm2, ymm3
        vpxord ymm1, ymm1, ymm2
        vprord ymm1, ymm1, 12
        vpaddd ymm0, ymm0, ymm5
        vpaddd ymm0, ymm0, ymm1
        vpxord ymm3, ymm3, ymm0
        vprord ymm3, ymm3, 8
        vpaddd ymm2, ymm2, ymm3
        vpxord ymm1, ymm1, ymm2
        vprord ymm1, ymm1, 7
        vpshufd ymm0, ymm0, 0x93
        vpshufd ymm3, ymm3, 0x4E
        vpshufd ymm2, ymm2, 0x39
        vpaddd ymm0, ymm0, ymm6
        vpaddd ymm0, ymm0, ymm1
        vpxord ymm3, ymm3, ymm0
        vprord ymm3, ymm3, 16
        vpaddd ymm2, ymm2, ymm3
        vpxord ymm1, ymm1, ymm2
        vprord ymm1, ymm1, 12
        vpaddd ymm0, ymm0, ymm7
        vpaddd ymm0, ymm0, ymm1
        vpxord ymm3, ymm3, ymm0
        vprord ymm3, ymm3, 8
        vpaddd ymm2, ymm2, ymm3
        vpxord ymm1, ymm1, ymm2
        vprord ymm1, ymm1, 7
        vpshufd ymm0, ymm0, 0x39
        vpshufd ymm3, ymm3, 0x4E
        vpshufd ymm2, ymm2, 0x93
        vshufps ymm8, ymm4, ymm5, 214
        vpshufd ymm9, ymm4, 0x0F
        vpshufd ymm4, ymm8, 0x39
        vshufps ymm8, ymm6, ymm7, 250
        vpblendd ymm9, ymm9, ymm8, 0xAA
        vpunpcklqdq ymm8, ymm7, ymm5
        vpblendd ymm8, ymm8, ymm6, 0x88
        vpshufd ymm8, ymm8, 0x78
        vpunpckhdq ymm5, ymm5, ymm7
        vpunpckldq ymm6, ymm6, ymm5
        vpshufd ymm7, ymm6, 0x1E
        vmovdqa ymm5, ymm9
        vmovdqa ymm6, ymm8
        vpaddd ymm0, ymm0, ymm4
        vpaddd ymm0, ymm0, ymm1
        vpxord ymm3, ymm3, ymm0
        vprord ymm3, ymm3, 16
        vpaddd ymm2, ymm2, ymm3
        vpxord ymm1, ymm1, ymm2
        vprord ymm1, ymm1, 12
        vpaddd ymm0, ymm0, ymm5
        vpaddd ymm0, ymm0, ymm1
        vpxord ymm3, ymm3, ymm0
        vprord ymm3, ymm3, 8
        vpaddd ymm2, ymm2, ymm3
        vpxord ymm1, ymm1, ymm2
        vprord ymm1, ymm1, 7
        vpshufd ymm0, ymm0, 0x93
        vpshufd ymm3, ymm3, 0x4E
        vpshufd ymm2, ymm2, 0x39
        vpaddd ymm0, ymm0, ymm6
        vpaddd ymm0, ymm0, ymm1
        vpxord ymm3, ymm3, ymm0
        vprord ymm3, ymm3, 16
        vpaddd ymm2, ymm2, ymm3
        vpxord ymm1, ymm1, ymm2
        vprord ymm1, ymm1, 12
        vpaddd ymm0, ymm0, ymm7
        vpaddd ymm0, ymm0, ymm1
        vpxord ymm3, ymm3, ymm0
        vprord ymm3, ymm3, 8
        vpaddd ymm2, ymm2, ymm3
        vpxord ymm1, ymm1, ymm2
        vprord ymm1, ymm1, 7
        vpshufd ymm0, ymm0, 0x39
        vpshufd ymm3, ymm3, 0x4E
        vpshufd ymm2, ymm2, 0x93
        vshufps ymm8, ymm4, ymm5, 214
        vpshufd ymm9, ymm4, 0x0F
        vpshufd ymm4, ymm8, 0x39
        vshufps ymm8, ymm6, ymm7, 250
        vpblendd ymm9, ymm9, ymm8, 0xAA
        vpunpcklqdq ymm8, ymm7, ymm5
        vpblendd ymm8, ymm8, ymm6, 0x88
        vpshufd ymm8, ymm8, 0x78
        vpunpckhdq ymm5, ymm5, ymm7
        vpunpckldq ymm6, ymm6, ymm5
        vpshufd ymm7, ymm6, 0x1E
        vmovdqa ymm5, ymm9
        vmovdqa ymm6, ymm8
        vpaddd ymm0, ymm0, ymm4
        vpaddd ymm0, ymm0, ymm1
        vpxord ymm3, ymm3, ymm0
        vprord ymm3, ymm3, 16
        vpaddd ymm2, ymm2, ymm3
        vpxord ymm1, ymm1, ymm2
        vprord ymm1, ymm1, 12
        vpaddd ymm0, ymm0, ymm5
        vpaddd ymm0, ymm0, ymm1
        vpxord ymm3, ymm3, ymm0
        vprord ymm3, ymm3, 8
        vpaddd ymm2, ymm2, ymm3
        vpxord ymm1, ymm1, ymm2
        vprord ymm1, ymm1, 7
        vpshufd ymm0, ymm0, 0x93
        vpshufd ymm3, ymm3, 0x4E
        vpshufd ymm2, ymm2, 0x39
        vpaddd ymm0, ymm0, ymm6
        vpaddd ymm0, ymm0, ymm1
        vpxord ymm3, ymm3, ymm0
        vprord ymm3, ymm3, 16
        vpaddd ymm2, ymm2, ymm3
        vpxord ymm1, ymm1, ymm2
        vprord ymm1, ymm1, 12
        vpaddd ymm0, ymm0, ymm7
        vpaddd ymm0, ymm0, ymm1
        vpxord ymm3, ymm3, ymm0
        vprord ymm3, ymm3, 8
        vpaddd ymm2, ymm2, ymm3
        vpxord ymm1, ymm1, ymm2
        vprord ymm1, ymm1, 7
        vpshufd ymm0, ymm0, 0x39
        vpshufd ymm3, ymm3, 0x4E
        vpshufd ymm2, ymm2, 0x93
        vpxord ymm0, ymm0, ymm2
        vpxord ymm1, ymm1, ymm3
        ret
blake3_avx512_kernel2d_4:
        vpaddd zmm0, zmm0, zmm4
        vpaddd zmm0, zmm0, zmm1
        vpxord zmm3, zmm3, zmm0
        vprord zmm3, zmm3, 16
        vpaddd zmm2, zmm2, zmm3
        vpxord zmm1, zmm1, zmm2
        vprord zmm1, zmm1, 12
        vpaddd zmm0, zmm0, zmm5
        vpaddd zmm0, zmm0, zmm1
        vpxord zmm3, zmm3, zmm0
        vprord zmm3, zmm3, 8
        vpaddd zmm2, zmm2, zmm3
        vpxord zmm1, zmm1, zmm2
        vprord zmm1, zmm1, 7
        vpshufd zmm0, zmm0, 0x93
        vpshufd zmm3, zmm3, 0x4E
        vpshufd zmm2, zmm2, 0x39
        vpaddd zmm0, zmm0, zmm6
        vpaddd zmm0, zmm0, zmm1
        vpxord zmm3, zmm3, zmm0
        vprord zmm3, zmm3, 16
        vpaddd zmm2, zmm2, zmm3
        vpxord zmm1, zmm1, zmm2
        vprord zmm1, zmm1, 12
        vpaddd zmm0, zmm0, zmm7
        vpaddd zmm0, zmm0, zmm1
        vpxord zmm3, zmm3, zmm0
        vprord zmm3, zmm3, 8
        vpaddd zmm2, zmm2, zmm3
        vpxord zmm1, zmm1, zmm2
        vprord zmm1, zmm1, 7
        vpshufd zmm0, zmm0, 0x39
        vpshufd zmm3, zmm3, 0x4E
        vpshufd zmm2, zmm2, 0x93
        vshufps zmm8, zmm4, zmm5, 214
        vpshufd zmm9, zmm4, 0x0F
        vpshufd zmm4, zmm8, 0x39
        vshufps zmm8, zmm6, zmm7, 250
        vpblendmd zmm9 {k3}, zmm9, zmm8
        vpunpcklqdq zmm8, zmm7, zmm5
        vpblendmd zmm8 {k4}, zmm8, zmm6
        vpshufd zmm8, zmm8, 0x78
        vpunpckhdq zmm5, zmm5, zmm7
        vpunpckldq zmm6, zmm6, zmm5
        vpshufd zmm7, zmm6, 0x1E
        vmovdqa32 zmm5, zmm9
        vmovdqa32 zmm6, zmm8
        vpaddd zmm0, zmm0, zmm4
        vpaddd zmm0, zmm0, zmm1
        vpxord zmm3, zmm3, zmm0
        vprord zmm3, zmm3, 16
        vpaddd zmm2, zmm2, zmm3
        vpxord zmm1, zmm1, zmm2
        vprord zmm1, zmm1, 12
        vpaddd zmm0, zmm0, zmm5
        vpaddd zmm0, zmm0, zmm1
        vpxord zmm3, zmm3, zmm0
        vprord zmm3, zmm3, 8
        vpaddd zmm2, zmm2, zmm3
        vpxord zmm1, zmm1, zmm2
        vprord zmm1, zmm1, 7
        vpshufd zmm0, zmm0, 0x93
        vpshufd zmm3, zmm3, 0x4E
        vpshufd zmm2, zmm2, 0x39
        vpaddd zmm0, zmm0, zmm6
        vpaddd zmm0, zmm0, zmm1
        vpxord zmm3, zmm3, zmm0
        vprord zmm3, zmm3, 16
        vpaddd zmm2, zmm2, zmm3
        vpxord zmm1, zmm1, zmm2
        vprord zmm1, zmm1, 12
        vpaddd zmm0, zmm0, zmm7
        vpaddd zmm0, zmm0, zmm1
        vpxord zmm3, zmm3, zmm0
        vprord zmm3, zmm3, 8
        vpaddd zmm2, zmm2, zmm3
        vpxord zmm1, zmm1, zmm2
        vprord zmm1, zmm1, 7
        vpshufd zmm0, zmm0, 0x39
        vpshufd zmm3, zmm3, 0x4E
        vpshufd zmm2, zmm2, 0x93
        vshufps zmm8, zmm4, zmm5, 214
        vpshufd zmm9, zmm4, 0x0F
        vpshufd zmm4, zmm8, 0x39
        vshufps zmm8, zmm6, zmm7, 250
        vpblendmd zmm9 {k3}, zmm9, zmm8
        vpunpcklqdq zmm8, zmm7, zmm5
        vpblendmd zmm8 {k4}, zmm8, zmm6
        vpshufd zmm8, zmm8, 0x78
        vpunpckhdq zmm5, zmm5, zmm7
        vpunpckldq zmm6, zmm6, zmm5
        vpshufd zmm7, zmm6, 0x1E
        vmovdqa32 zmm5, zmm9
        vmovdqa32 zmm6, zmm8
        vpaddd zmm0, zmm0, zmm4
        vpaddd zmm0, zmm0, zmm1
        vpxord zmm3, zmm3, zmm0
        vprord zmm3, zmm3, 16
        vpaddd zmm2, zmm2, zmm3
        vpxord zmm1, zmm1, zmm2
        vprord zmm1, zmm1, 12
        vpaddd zmm0, zmm0, zmm5
        vpaddd zmm0, zmm0, zmm1
        vpxord zmm3, zmm3, zmm0
        vprord zmm3, zmm3, 8
        vpaddd zmm2, zmm2, zmm3
        vpxord zmm1, zmm1, zmm2
        vprord zmm1, zmm1, 7
        vpshufd zmm0, zmm0, 0x93
        vpshufd zmm3, zmm3, 0x4E
        vpshufd zmm2, zmm2, 0x39
        vpaddd zmm0, zmm0, zmm6
        vpaddd zmm0, zmm0, zmm1
        vpxord zmm3, zmm3, zmm0
        vprord zmm3, zmm3, 16
        vpaddd zmm2, zmm2, zmm3
        vpxord zmm1, zmm1, zmm2
        vprord zmm1, zmm1, 12
        vpaddd zmm0, zmm0, zmm7
        vpaddd zmm0, zmm0, zmm1
        vpxord zmm3, zmm3, zmm0
        vprord zmm3, zmm3, 8
        vpaddd zmm2, zmm2, zmm3
        vpxord zmm1, zmm1, zmm2
        vprord zmm1, zmm1, 7
        vpshufd zmm0, zmm0, 0x39
        vpshufd zmm3, zmm3, 0x4E
        vpshufd zmm2, zmm2, 0x93
        vshufps zmm8, zmm4, zmm5, 214
        vpshufd zmm9, zmm4, 0x0F
        vpshufd zmm4, zmm8, 0x39
        vshufps zmm8, zmm6, zmm7, 250
        vpblendmd zmm9 {k3}, zmm9, zmm8
        vpunpcklqdq zmm8, zmm7, zmm5
        vpblendmd zmm8 {k4}, zmm8, zmm6
        vpshufd zmm8, zmm8, 0x78
        vpunpckhdq zmm5, zmm5, zmm7
        vpunpckldq zmm6, zmm6, zmm5
        vpshufd zmm7, zmm6, 0x1E
        vmovdqa32 zmm5, zmm9
        vmovdqa32 zmm6, zmm8
        vpaddd zmm0, zmm0, zmm4
        vpaddd zmm0, zmm0, zmm1
        vpxord zmm3, zmm3, zmm0
        vprord zmm3, zmm3, 16
        vpaddd zmm2, zmm2, zmm3
        vpxord zmm1, zmm1, zmm2
        vprord zmm1, zmm1, 12
        vpaddd zmm0, zmm0, zmm5
        vpaddd zmm0, zmm0, zmm1
        vpxord zmm3, zmm3, zmm0
        vprord zmm3, zmm3, 8
        vpaddd zmm2, zmm2, zmm3
        vpxord zmm1, zmm1, zmm2
        vprord zmm1, zmm1, 7
        vpshufd zmm0, zmm0, 0x93
        vpshufd zmm3, zmm3, 0x4E
        vpshufd zmm2, zmm2, 0x39
        vpaddd zmm0, zmm0, zmm6
        vpaddd zmm0, zmm0, zmm1
        vpxord zmm3, zmm3, zmm0
        vprord zmm3, zmm3, 16
        vpaddd zmm2, zmm2, zmm3
        vpxord zmm1, zmm1, zmm2
        vprord zmm1, zmm1, 12
        vpaddd zmm0, zmm0, zmm7
        vpaddd zmm0, zmm0, zmm1
        vpxord zmm3, zmm3, zmm0
        vprord zmm3, zmm3, 8
        vpaddd zmm2, zmm2, zmm3
        vpxord zmm1, zmm1, zmm2
        vprord zmm1, zmm1, 7
        vpshufd zmm0, zmm0, 0x39
        vpshufd zmm3, zmm3, 0x4E
        vpshufd zmm2, zmm2, 0x93
        vshufps zmm8, zmm4, zmm5, 214
        vpshufd zmm9, zmm4, 0x0F
        vpshufd zmm4, zmm8, 0x39
        vshufps zmm8, zmm6, zmm7, 250
        vpblendmd zmm9 {k3}, zmm9, zmm8
        vpunpcklqdq zmm8, zmm7, zmm5
        vpblendmd zmm8 {k4}, zmm8, zmm6
        vpshufd zmm8, zmm8, 0x78
        vpunpckhdq zmm5, zmm5, zmm7
        vpunpckldq zmm6, zmm6, zmm5
        vpshufd zmm7, zmm6, 0x1E
        vmovdqa32 zmm5, zmm9
        vmovdqa32 zmm6, zmm8
        vpaddd zmm0, zmm0, zmm4
        vpaddd zmm0, zmm0, zmm1
        vpxord zmm3, zmm3, zmm0
        vprord zmm3, zmm3, 16
        vpaddd zmm2, zmm2, zmm3
        vpxord zmm1, zmm1, zmm2
        vprord zmm1, zmm1, 12
        vpaddd zmm0, zmm0, zmm5
        vpaddd zmm0, zmm0, zmm1
        vpxord zmm3, zmm3, zmm0
        vprord zmm3, zmm3, 8
        vpaddd zmm2, zmm2, zmm3
        vpxord zmm1, zmm1, zmm2
        vprord zmm1, zmm1, 7
        vpshufd zmm0, zmm0, 0x93
        vpshufd zmm3, zmm3, 0x4E
        vpshufd zmm2, zmm2, 0x39
        vpaddd zmm0, zmm0, zmm6
        vpaddd zmm0, zmm0, zmm1
        vpxord zmm3, zmm3, zmm0
        vprord zmm3, zmm3, 16
        vpaddd zmm2, zmm2, zmm3
        vpxord zmm1, zmm1, zmm2
        vprord zmm1, zmm1, 12
        vpaddd zmm0, zmm0, zmm7
        vpaddd zmm0, zmm0, zmm1
        vpxord zmm3, zmm3, zmm0
        vprord zmm3, zmm3, 8
        vpaddd zmm2, zmm2, zmm3
        vpxord zmm1, zmm1, zmm2
        vprord zmm1, zmm1, 7
        vpshufd zmm0, zmm0, 0x39
        vpshufd zmm3, zmm3, 0x4E
        vpshufd zmm2, zmm2, 0x93
        vshufps zmm8, zmm4, zmm5, 214
        vpshufd zmm9, zmm4, 0x0F
        vpshufd zmm4, zmm8, 0x39
        vshufps zmm8, zmm6, zmm7, 250
        vpblendmd zmm9 {k3}, zmm9, zmm8
        vpunpcklqdq zmm8, zmm7, zmm5
        vpblendmd zmm8 {k4}, zmm8, zmm6
        vpshufd zmm8, zmm8, 0x78
        vpunpckhdq zmm5, zmm5, zmm7
        vpunpckldq zmm6, zmm6, zmm5
        vpshufd zmm7, zmm6, 0x1E
        vmovdqa32 zmm5, zmm9
        vmovdqa32 zmm6, zmm8
        vpaddd zmm0, zmm0, zmm4
        vpaddd zmm0, zmm0, zmm1
        vpxord zmm3, zmm3, zmm0
        vprord zmm3, zmm3, 16
        vpaddd zmm2, zmm2, zmm3
        vpxord zmm1, zmm1, zmm2
        vprord zmm1, zmm1, 12
        vpaddd zmm0, zmm0, zmm5
        vpaddd zmm0, zmm0, zmm1
        vpxord zmm3, zmm3, zmm0
        vprord zmm3, zmm3, 8
        vpaddd zmm2, zmm2, zmm3
        vpxord zmm1, zmm1, zmm2
        vprord zmm1, zmm1, 7
        vpshufd zmm0, zmm0, 0x93
        vpshufd zmm3, zmm3, 0x4E
        vpshufd zmm2, zmm2, 0x39
        vpaddd zmm0, zmm0, zmm6
        vpaddd zmm0, zmm0, zmm1
        vpxord zmm3, zmm3, zmm0
        vprord zmm3, zmm3, 16
        vpaddd zmm2, zmm2, zmm3
        vpxord zmm1, zmm1, zmm2
        vprord zmm1, zmm1, 12
        vpaddd zmm0, zmm0, zmm7
        vpaddd zmm0, zmm0, zmm1
        vpxord zmm3, zmm3, zmm0
        vprord zmm3, zmm3, 8
        vpaddd zmm2, zmm2, zmm3
        vpxord zmm1, zmm1, zmm2
        vprord zmm1, zmm1, 7
        vpshufd zmm0, zmm0, 0x39
        vpshufd zmm3, zmm3, 0x4E
        vpshufd zmm2, zmm2, 0x93
        vshufps zmm8, zmm4, zmm5, 214
        vpshufd zmm9, zmm4, 0x0F
        vpshufd zmm4, zmm8, 0x39
        vshufps zmm8, zmm6, zmm7, 250
        vpblendmd zmm9 {k3}, zmm9, zmm8
        vpunpcklqdq zmm8, zmm7, zmm5
        vpblendmd zmm8 {k4}, zmm8, zmm6
        vpshufd zmm8, zmm8, 0x78
        vpunpckhdq zmm5, zmm5, zmm7
        vpunpckldq zmm6, zmm6, zmm5
        vpshufd zmm7, zmm6, 0x1E
        vmovdqa32 zmm5, zmm9
        vmovdqa32 zmm6, zmm8
        vpaddd zmm0, zmm0, zmm4
        vpaddd zmm0, zmm0, zmm1
        vpxord zmm3, zmm3, zmm0
        vprord zmm3, zmm3, 16
        vpaddd zmm2, zmm2, zmm3
        vpxord zmm1, zmm1, zmm2
        vprord zmm1, zmm1, 12
        vpaddd zmm0, zmm0, zmm5
        vpaddd zmm0, zmm0, zmm1
        vpxord zmm3, zmm3, zmm0
        vprord zmm3, zmm3, 8
        vpaddd zmm2, zmm2, zmm3
        vpxord zmm1, zmm1, zmm2
        vprord zmm1, zmm1, 7
        vpshufd zmm0, zmm0, 0x93
        vpshufd zmm3, zmm3, 0x4E
        vpshufd zmm2, zmm2, 0x39
        vpaddd zmm0, zmm0, zmm6
        vpaddd zmm0, zmm0, zmm1
        vpxord zmm3, zmm3, zmm0
        vprord zmm3, zmm3, 16
        vpaddd zmm2, zmm2, zmm3
        vpxord zmm1, zmm1, zmm2
        vprord zmm1, zmm1, 12
        vpaddd zmm0, zmm0, zmm7
        vpaddd zmm0, zmm0, zmm1
        vpxord zmm3, zmm3, zmm0
        vprord zmm3, zmm3, 8
        vpaddd zmm2, zmm2, zmm3
        vpxord zmm1, zmm1, zmm2
        vprord zmm1, zmm1, 7
        vpshufd zmm0, zmm0, 0x39
        vpshufd zmm3, zmm3, 0x4E
        vpshufd zmm2, zmm2, 0x93
        vpxord zmm0, zmm0, zmm2
        vpxord zmm1, zmm1, zmm3
        ret
.global blake3_avx512_compress
blake3_avx512_compress:
        vmovdqu xmm0, xmmword ptr [rdi]
        vmovdqu xmm1, xmmword ptr [rdi+0x10]
        shl r8, 32
        mov ecx, ecx
        or rcx, r8
        vmovq xmm3, rdx
        vmovq xmm4, rcx
        vpunpcklqdq xmm3, xmm3, xmm4
        vmovaps xmm2, xmmword ptr [BLAKE3_IV+rip]
        vmovups xmm8, xmmword ptr [rsi]
        vmovups xmm9, xmmword ptr [rsi+0x10]
        vshufps xmm4, xmm8, xmm9, 136
        vshufps xmm5, xmm8, xmm9, 221
        vmovups xmm8, xmmword ptr [rsi+0x20]
        vmovups xmm9, xmmword ptr [rsi+0x30]
        vshufps xmm6, xmm8, xmm9, 136
        vshufps xmm7, xmm8, xmm9, 221
        vpshufd xmm6, xmm6, 0x93
        vpshufd xmm7, xmm7, 0x93
        call blake3_avx512_kernel2d_1
        vmovdqu xmmword ptr [rdi], xmm0
        vmovdqu xmmword ptr [rdi+0x10], xmm1
        ret
.balign 16
BLAKE3_IV:
BLAKE3_IV_0:
.long 0x6A09E667
BLAKE3_IV_1:
.long 0xBB67AE85
BLAKE3_IV_2:
.long 0x3C6EF372
BLAKE3_IV_3:
.long 0xA54FF53A
.balign 16
ROT16:
.byte  2, 3, 0, 1, 6, 7, 4, 5, 10, 11, 8, 9, 14, 15, 12, 13
ROT8:
.byte  1, 2, 3, 0, 5, 6, 7, 4, 9, 10, 11, 8, 13, 14, 15, 12
